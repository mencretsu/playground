<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stochastic Trading Simulator Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e27;
            padding: 10px;
            min-height: 100vh;
            color: #e2e8f0;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: #1a1f3a;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        }
        h1 {
            text-align: center;
            color: #60a5fa;
            margin-bottom: 5px;
            font-size: 1.5em;
        }
        .subtitle {
            text-align: center;
            color: #94a3b8;
            margin-bottom: 15px;
            font-size: 0.8em;
        }
        
        /* LIVE PRICE BANNER */
        .live-price-banner {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(16, 185, 129, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        .live-price-label {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.9);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
        }
        .live-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #00ff00;
            border-radius: 50%;
            animation: blink 1.5s infinite;
            margin-right: 6px;
            box-shadow: 0 0 10px #00ff00;
        }
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        .live-price-value {
            font-size: 2.5em;
            font-weight: bold;
            color: white;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
            text-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .live-price-change {
            font-size: 1em;
            font-weight: 600;
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
        }
        .live-price-change.positive {
            background: rgba(209, 250, 229, 0.2);
            color: #d1fae5;
        }
        .live-price-change.negative {
            background: rgba(254, 202, 202, 0.2);
            color: #fecaca;
        }
        
        .status-line {
            background: #0f172a;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 3px solid #60a5fa;
        }
        .status-line h3 {
            color: #e2e8f0;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        .params {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }
        .param {
            background: #1e293b;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #334155;
        }
        .param-label {
            font-weight: 600;
            color: #60a5fa;
            font-size: 0.75em;
        }
        .param-value {
            color: #f1f5f9;
            font-size: 0.95em;
            margin-top: 2px;
        }
        .chart-container {
            position: relative;
            height: 280px;
            margin-bottom: 15px;
            background: #0f172a;
            padding: 12px;
            border-radius: 8px;
        }
        .signal-box {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-top: 12px;
        }
        @media (max-width: 768px) {
            .signal-box {
                grid-template-columns: 1fr;
            }
            .params {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        .trade-signal {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 12px;
            border: 2px solid #334155;
        }
        .trade-signal h2 {
            color: #60a5fa;
            font-size: 1em;
            margin-bottom: 10px;
        }
        .trade-action {
            font-size: 1.8em;
            font-weight: bold;
            margin: 12px 0;
            padding: 12px;
            border-radius: 8px;
            text-transform: uppercase;
        }
        .buy-signal {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        .sell-signal {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            animation: pulse 2s infinite;
        }
        .hold-signal {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }
        .trade-reason {
            color: #cbd5e1;
            font-size: 0.85em;
            margin-top: 8px;
            line-height: 1.4;
        }

        /* RISK WARNING */
        .risk-warning {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            border: 2px solid #fca5a5;
            animation: pulse-warning 2s infinite;
        }
        @keyframes pulse-warning {
            0%, 100% { box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7); }
            50% { box-shadow: 0 0 0 8px rgba(220, 38, 38, 0); }
        }
        .risk-warning h4 {
            color: white;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        .risk-warning p {
            color: #fecaca;
            font-size: 0.8em;
            line-height: 1.4;
        }

        /* TRADING SIMULATOR */
        .simulator-box {
            background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 2px solid rgba(139, 92, 246, 0.5);
        }
        .simulator-box h3 {
            color: white;
            margin-bottom: 12px;
            font-size: 1.1em;
            text-align: center;
        }
        .sim-inputs {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 12px;
        }
        @media (max-width: 480px) {
            .sim-inputs {
                grid-template-columns: 1fr;
            }
            .live-price-value {
                font-size: 2em;
            }
        }
        .sim-input-field {
            display: flex;
            flex-direction: column;
        }
        .sim-input-field label {
            font-weight: 600;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 5px;
            font-size: 0.8em;
        }
        .sim-input-field input,
        .sim-input-field select {
            padding: 10px;
            border: 1px solid rgba(139, 92, 246, 0.5);
            border-radius: 6px;
            font-size: 0.9em;
            background: rgba(0, 0, 0, 0.3);
            color: white;
            transition: border-color 0.3s;
        }
        .sim-input-field input:focus,
        .sim-input-field select:focus {
            outline: none;
            border-color: #a78bfa;
        }

        /* MULTIPLE ENTRIES */
        .entries-box {
            background: #0f172a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 2px solid #334155;
        }
        .entries-box h3 {
            color: #fbbf24;
            margin-bottom: 12px;
            font-size: 1em;
            text-align: center;
        }
        .entry-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        @media (max-width: 768px) {
            .entry-grid {
                grid-template-columns: 1fr;
            }
        }
        .entry-card {
            background: #1e293b;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid #fbbf24;
        }
        .entry-card h4 {
            font-size: 0.85em;
            color: #fbbf24;
            margin-bottom: 8px;
            text-align: center;
        }
        .entry-detail {
            background: #0f172a;
            padding: 8px;
            border-radius: 6px;
            margin: 6px 0;
        }
        .entry-detail .label {
            font-size: 0.7em;
            color: #94a3b8;
            text-transform: uppercase;
        }
        .entry-detail .value {
            font-size: 1em;
            font-weight: bold;
            color: #f1f5f9;
            font-family: 'Courier New', monospace;
        }

        /* MULTIPLE TPs */
        .tp-box {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 2px solid rgba(16, 185, 129, 0.5);
        }
        .tp-box h3 {
            color: white;
            margin-bottom: 12px;
            font-size: 1em;
            text-align: center;
        }
        .tp-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        @media (max-width: 480px) {
            .tp-grid {
                grid-template-columns: 1fr;
            }
        }
        .tp-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .tp-card h4 {
            font-size: 0.75em;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 8px;
            text-align: center;
        }
        .tp-card .price {
            font-size: 1.2em;
            font-weight: bold;
            color: white;
            text-align: center;
            margin: 5px 0;
            font-family: 'Courier New', monospace;
        }
        .tp-card .profit {
            font-size: 0.85em;
            color: #d1fae5;
            text-align: center;
            margin-top: 5px;
        }

        /* SL BOX */
        .sl-box {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 2px solid rgba(239, 68, 68, 0.5);
        }
        .sl-box h3 {
            color: white;
            margin-bottom: 10px;
            font-size: 1em;
            text-align: center;
        }
        .sl-detail {
            background: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 8px;
        }
        .sl-detail .price {
            font-size: 1.5em;
            font-weight: bold;
            color: white;
            text-align: center;
            margin: 8px 0;
            font-family: 'Courier New', monospace;
        }
        .sl-detail .loss {
            font-size: 1em;
            color: #fecaca;
            text-align: center;
        }

        /* RISK MANAGEMENT */
        .risk-box {
            background: #0f172a;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 12px;
            border-left: 3px solid #8b5cf6;
        }
        .risk-box h3 {
            color: #a78bfa;
            margin-bottom: 12px;
            font-size: 1em;
        }
        .risk-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }
        @media (max-width: 480px) {
            .risk-grid {
                grid-template-columns: 1fr;
            }
        }
        .risk-item {
            background: #1e293b;
            padding: 12px;
            border-radius: 8px;
        }
        .risk-item h4 {
            font-size: 0.75em;
            color: #94a3b8;
            margin-bottom: 5px;
        }
        .risk-item .value {
            font-size: 1.3em;
            font-weight: bold;
            color: #f1f5f9;
            font-family: 'Courier New', monospace;
        }
        .risk-item.safe .value {
            color: #10b981;
        }
        .risk-item.warning .value {
            color: #f59e0b;
        }
        .risk-item.danger .value {
            color: #ef4444;
        }
        
        .guide-box {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 3px solid #60a5fa;
        }
        .guide-box h3 {
            color: #60a5fa;
            margin-bottom: 10px;
            font-size: 1em;
        }
        .guide-item {
            background: #1e293b;
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 3px solid #334155;
        }
        .guide-item.buy {
            border-left-color: #10b981;
        }
        .guide-item.sell {
            border-left-color: #ef4444;
        }
        .guide-item strong {
            color: #f1f5f9;
            font-size: 0.9em;
            display: block;
            margin-bottom: 5px;
        }
        .guide-item p {
            color: #94a3b8;
            margin-top: 5px;
            line-height: 1.4;
            font-size: 0.8em;
        }
        .signal {
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            transition: transform 0.2s;
            background: #1e293b;
            border: 1px solid #334155;
        }
        .signal:active {
            transform: scale(0.98);
        }
        .signal h3 {
            margin-bottom: 6px;
            font-size: 0.85em;
            color: #94a3b8;
        }
        .signal .value {
            font-size: 1.6em;
            font-weight: bold;
            margin: 6px 0;
            color: #f1f5f9;
        }
        .signal .status {
            font-size: 0.75em;
            padding: 5px;
            border-radius: 4px;
            margin-top: 6px;
            background: #0f172a;
            color: #cbd5e1;
        }
        .k-signal {
            border-left: 3px solid #60a5fa;
        }
        .d-signal {
            border-left: 3px solid #f472b6;
        }
        .zone-signal {
            border-left: 3px solid #34d399;
        }
        .oversold {
            background: #10b981 !important;
            color: #d1fae5 !important;
        }
        .overbought {
            background: #ef4444 !important;
            color: #fecaca !important;
        }
        .neutral {
            background: #374151 !important;
            color: #e5e7eb !important;
        }
        .controls {
            background: #0f172a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
        }
        .controls h3 {
            color: #e2e8f0;
            margin-bottom: 12px;
            font-size: 1em;
        }
        .input-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 12px;
        }
        .input-field {
            display: flex;
            flex-direction: column;
        }
        .input-field label {
            font-weight: 600;
            color: #94a3b8;
            margin-bottom: 5px;
            font-size: 0.8em;
        }
        .input-field input,
        .input-field select {
            padding: 10px;
            border: 1px solid #334155;
            border-radius: 6px;
            font-size: 0.9em;
            background: #1e293b;
            color: #f1f5f9;
            transition: border-color 0.3s;
        }
        .input-field input:focus,
        .input-field select:focus {
            outline: none;
            border-color: #60a5fa;
        }
        button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 6px;
            font-size: 0.95em;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: 600;
            width: 100%;
        }
        button:active {
            transform: scale(0.98);
        }
        #loading, #error-msg {
            text-align: center;
            margin-top: 8px;
            font-size: 0.85em;
            padding: 8px;
            border-radius: 6px;
        }
        #loading {
            display: none;
            color: #60a5fa;
            background: #1e3a5f;
        }
        #error-msg {
            display: none;
            color: #fca5a5;
            background: #7f1d1d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ Stochastic Simulator PRO</h1>
        <p class="subtitle">Multiple Entries + 5 TP Levels + Risk Management</p>

        <!-- LIVE PRICE BANNER -->
        <div class="live-price-banner" id="livePriceBanner">
            <div class="live-price-label">
                <span class="live-indicator"></span>
                LIVE PRICE - <span id="liveSymbol">BTC/USDT</span>
            </div>
            <div class="live-price-value" id="livePrice">Loading...</div>
            <div class="live-price-change positive" id="livePriceChange">--</div>
        </div>

        <div class="status-line">
            <h3>üìä Stochastic Parameters</h3>
            <div class="params">
                <div class="param">
                    <div class="param-label">K Length</div>
                    <div class="param-value" id="display-k-length">5</div>
                </div>
                <div class="param">
                    <div class="param-label">K Smoothing</div>
                    <div class="param-value" id="display-k-smooth">3</div>
                </div>
                <div class="param">
                    <div class="param-label">D Smoothing</div>
                    <div class="param-value" id="display-d-smooth">3</div>
                </div>
                <div class="param">
                    <div class="param-label">Timeframe</div>
                    <div class="param-value" id="display-timeframe">4H</div>
                </div>
            </div>
        </div>

        <div class="controls">
            <h3>‚öôÔ∏è Chart Settings</h3>
            <div class="input-group">
                <div class="input-field">
                    <label>Coin/Token:</label>
                    <select id="symbol">
                        <option value="BTCUSDT">BTC/USDT</option>
                        <option value="ETHUSDT">ETH/USDT</option>
                        <option value="BNBUSDT">BNB/USDT</option>
                        <option value="SOLUSDT">SOL/USDT</option>
                        <option value="XRPUSDT">XRP/USDT</option>
                        <option value="ADAUSDT">ADA/USDT</option>
                        <option value="DOGEUSDT">DOGE/USDT</option>
                        <option value="AVAXUSDT">AVAX/USDT</option>
                        <option value="MATICUSDT">MATIC/USDT</option>
                        <option value="DOTUSDT">DOT/USDT</option>
                        <option value="LINKUSDT">LINK/USDT</option>
                        <option value="UNIUSDT">UNI/USDT</option>
                    </select>
                </div>
                <div class="input-field">
                    <label>Timeframe:</label>
                    <select id="timeframe">
                        <option value="1m">1 Menit</option>
                        <option value="5m">5 Menit</option>
                        <option value="15m">15 Menit</option>
                        <option value="30m">30 Menit</option>
                        <option value="1h">1 Jam</option>
                        <option value="4h" selected>4 Jam</option>
                        <option value="1d">1 Hari</option>
                        <option value="1w">1 Minggu</option>
                    </select>
                </div>
                <div class="input-field">
                    <label>K Length:</label>
                    <input type="number" id="k-length" value="5" min="1" max="50">
                </div>
                <div class="input-field">
                    <label>K Smoothing:</label>
                    <input type="number" id="k-smooth" value="3" min="1" max="20">
                </div>
                <div class="input-field">
                    <label>D Smoothing:</label>
                    <input type="number" id="d-smooth" value="3" min="1" max="20">
                </div>
            </div>
            <button onclick="updateChart()">üîÑ Load Data & Calculate</button>
            <div id="loading">‚è≥ Loading data...</div>
            <div id="error-msg"></div>
        </div>

        <!-- TRADING SIMULATOR INPUT -->
        <div class="simulator-box">
            <h3>üí∞ Money Management Settings</h3>
            <div class="sim-inputs">
                <div class="sim-input-field">
                    <label>Total Modal (USDT):</label>
                    <input type="number" id="modal" value="100" min="1" step="1">
                </div>
                <div class="sim-input-field">
                    <label>Leverage:</label>
                    <select id="leverage">
                        <option value="1">1x (Spot)</option>
                        <option value="2">2x</option>
                        <option value="3">3x</option>
                        <option value="5" selected>5x</option>
                        <option value="10">10x</option>
                        <option value="20">20x</option>
                        <option value="50">50x</option>
                        <option value="100">100x</option>
                    </select>
                </div>
                <div class="sim-input-field">
                    <label>Entry 1 (%):</label>
                    <input type="number" id="entry1-pct" value="30" min="10" max="100" step="5">
                </div>
                <div class="sim-input-field">
                    <label>Entry 2 (%):</label>
                    <input type="number" id="entry2-pct" value="30" min="0" max="100" step="5">
                </div>
                <div class="sim-input-field">
                    <label>Entry 3 (%):</label>
                    <input type="number" id="entry3-pct" value="40" min="0" max="100" step="5">
                </div>
                <div class="sim-input-field">
                    <label>SL Distance (%):</label>
                    <input type="number" id="sl-percent" value="2" min="0.1" step="0.1">
                </div>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="stochChart"></canvas>
        </div>

        <div class="trade-signal">
            <h2>üì° CURRENT SIGNAL</h2>
            <div class="trade-action" id="trade-action">ANALYZING...</div>
            <div class="trade-reason" id="trade-reason">Menunggu data...</div>
        </div>

        <!-- RISK WARNING -->
        <div class="risk-warning" id="risk-warning" style="display: none;">
            <h4>‚ö†Ô∏è HIGH RISK WARNING!</h4>
            <p id="risk-warning-msg">--</p>
        </div>

        <!-- MULTIPLE ENTRIES -->
        <div class="entries-box" id="entries-box" style="display: none;">
            <h3>üìç MULTIPLE ENTRY STRATEGY - <span id="entry-type">--</span></h3>
            <div class="entry-grid">
                <div class="entry-card">
                    <h4>üéØ ENTRY 1</h4>
                    <div class="entry-detail">
                        <div class="label">Entry Price</div>
                        <div class="value" id="entry1-price">$--</div>
                    </div>
                    <div class="entry-detail">
                        <div class="label">Position Size</div>
                        <div class="value" id="entry1-size">$--</div>
                    </div>
                    <div class="entry-detail">
                        <div class="label">% of Capital</div>
                        <div class="value" id="entry1-pct-display">--</div>
                    </div>
                </div>
                <div class="entry-card">
                    <h4>üéØ ENTRY 2</h4>
                    <div class="entry-detail">
                        <div class="label">Entry Price</div>
                        <div class="value" id="entry2-price">$--</div>
                    </div>
                    <div class="entry-detail">
                        <div class="label">Position Size</div>
                        <div class="value" id="entry2-size">$--</div>
                    </div>
                    <div class="entry-detail">
                        <div class="label">% of Capital</div>
                        <div class="value" id="entry2-pct-display">--</div>
                    </div>
                </div>
                <div class="entry-card">
                    <h4>üéØ ENTRY 3</h4>
                    <div class="entry-detail">
                        <div class="label">Entry Price</div>
                        <div class="value" id="entry3-price">$--</div>
                    </div>
                    <div class="entry-detail">
                        <div class="label">Position Size</div>
                        <div class="value" id="entry3-size">$--</div>
                    </div>
                    <div class="entry-detail">
                        <div class="label">% of Capital</div>
                        <div class="value" id="entry3-pct-display">--</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- MULTIPLE TPs -->
        <div class="tp-box" id="tp-box" style="display: none;">
            <h3>‚úÖ 5 TAKE PROFIT LEVELS</h3>
            <div class="tp-grid">
                <div class="tp-card">
                    <h4>TP1 - Quick Profit</h4>
                    <div class="price" id="tp1-price">$--</div>
                    <div class="profit" id="tp1-profit">+$-- (+--% ROI)</div>
                </div>
                <div class="tp-card">
                    <h4>TP2 - Safe Zone</h4>
                    <div class="price" id="tp2-price">$--</div>
                    <div class="profit" id="tp2-profit">+$-- (+--% ROI)</div>
                </div>
                <div class="tp-card">
                    <h4>TP3 - Good Profit</h4>
                    <div class="price" id="tp3-price">$--</div>
                    <div class="profit" id="tp3-profit">+$-- (+--% ROI)</div>
                </div>
                <div class="tp-card">
                    <h4>TP4 - Big Profit</h4>
                    <div class="price" id="tp4-price">$--</div>
                    <div class="profit" id="tp4-profit">+$-- (+--% ROI)</div>
                </div>
                <div class="tp-card">
                    <h4>TP5 - Max Profit</h4>
                    <div class="price" id="tp5-price">$--</div>
                    <div class="profit" id="tp5-profit">+$-- (+--% ROI)</div>
                </div>
            </div>
        </div>

        <!-- STOP LOSS -->
        <div class="sl-box" id="sl-box" style="display: none;">
            <h3>‚ùå STOP LOSS (WAJIB!)</h3>
            <div class="sl-detail">
                <div class="price" id="sl-price">$--</div>
                <div class="loss" id="sl-loss">Loss: -$-- (--% of Capital)</div>
            </div>
        </div>

        <!-- RISK MANAGEMENT -->
        <div class="risk-box" id="risk-box" style="display: none;">
            <h3>‚ö° Risk Management Analysis</h3>
            <div class="risk-grid">
                <div class="risk-item safe">
                    <h4>Total Position Size</h4>
                    <div class="value" id="total-position">$--</div>
                </div>
                <div class="risk-item">
                    <h4>Effective Leverage</h4>
                    <div class="value" id="effective-leverage">--x</div>
                </div>
                <div class="risk-item">
                    <h4>Max Loss if SL Hit</h4>
                    <div class="value" id="max-loss">-$--</div>
                </div>
                <div class="risk-item">
                    <h4>Risk % of Capital</h4>
                    <div class="value" id="risk-pct">--%</div>
                </div>
                <div class="risk-item">
                    <h4>Liquidation Price</h4>
                    <div class="value" id="liq-price">$--</div>
                </div>
                <div class="risk-item">
                    <h4>Distance to Liq</h4>
                    <div class="value" id="liq-distance">--%</div>
                </div>
            </div>
        </div>

        <div class="signal-box">
            <div class="signal k-signal">
                <h3>%K Line</h3>
                <div class="value" id="k-value">--</div>
                <div class="status" id="k-status">Calculating...</div>
            </div>
            <div class="signal d-signal">
                <h3>%D Line</h3>
                <div class="value" id="d-value">--</div>
                <div class="status" id="d-status">Calculating...</div>
            </div>
            <div class="signal zone-signal" id="zone-box">
                <h3>Market Zone</h3>
                <div class="value" id="zone-value">--</div>
                <div class="status" id="zone-status">Analyzing...</div>
            </div>
        </div>

        <div class="guide-box">
            <h3>üìö Money Management Guide</h3>
            
            <div class="guide-item buy">
                <strong>üí° Multiple Entry Strategy</strong>
                <p>
                    ‚Ä¢ Entry 1 (30%): Main entry pas sinyal<br>
                    ‚Ä¢ Entry 2 (30%): Kalo harga turun/naik dikit (averaging)<br>
                    ‚Ä¢ Entry 3 (40%): Last entry kalo confirm trend<br>
                    ‚Ä¢ Jangan all-in 1x! Bagi modal = lebih aman
                </p>
            </div>

            <div class="guide-item sell">
                <strong>üéØ 5 TP Levels Strategy</strong>
                <p>
                    ‚Ä¢ TP1 (1%): Secure profit cepet<br>
                    ‚Ä¢ TP2 (2%): Safe profit zone<br>
                    ‚Ä¢ TP3 (3%): Good profit<br>
                    ‚Ä¢ TP4 (5%): Big profit<br>
                    ‚Ä¢ TP5 (8%): Maximum profit (greed mode)<br>
                    ‚Ä¢ Close sebagian posisi tiap TP = aman!
                </p>
            </div>

            <div class="guide-item">
                <strong>‚ö†Ô∏è Risk Management Rules</strong>
                <p>
                    ‚Ä¢ NEVER risk >2% modal per trade<br>
                    ‚Ä¢ High leverage = high risk MC!<br>
                    ‚Ä¢ Liquidation price harus jauh (>10%)<br>
                    ‚Ä¢ SL WAJIB! Jangan FOMO hold terus<br>
                    ‚Ä¢ Kalo risk >5% = BAHAYA! Kecilkan leverage
                </p>
            </div>
        </div>
    </div>

    <script>
        let chart;
        let kLength = 5;
        let kSmooth = 3;
        let dSmooth = 3;
        let currentPrice = 0;
        let previousPrice = 0;
        let currentSignalType = 'HOLD';

        async function fetchBinanceData(symbol, interval, limit = 100) {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('error-msg').style.display = 'none';
                
                const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=${interval}&limit=${limit}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error('Failed to fetch data from Binance');
                }
                
                const data = await response.json();
                document.getElementById('loading').style.display = 'none';
                
                return data.map(candle => ({
                    time: new Date(candle[0]),
                    open: parseFloat(candle[1]),
                    high: parseFloat(candle[2]),
                    low: parseFloat(candle[3]),
                    close: parseFloat(candle[4]),
                    volume: parseFloat(candle[5])
                }));
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error-msg').style.display = 'block';
                document.getElementById('error-msg').textContent = '‚ùå Error: ' + error.message;
                throw error;
            }
        }

        function calculateStochastic(data, kLen, kSm, dSm) {
            const kValues = [];
            
            for (let i = kLen - 1; i < data.length; i++) {
                const slice = data.slice(i - kLen + 1, i + 1);
                const high = Math.max(...slice.map(d => d.high));
                const low = Math.min(...slice.map(d => d.low));
                const close = data[i].close;
                const k = ((close - low) / (high - low)) * 100;
                kValues.push(k);
            }

            const smoothK = sma(kValues, kSm);
            const smoothD = sma(smoothK, dSm);

            return { k: smoothK, d: smoothD };
        }

        function sma(data, period) {
            const result = [];
            for (let i = period - 1; i < data.length; i++) {
                const sum = data.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
                result.push(sum / period);
            }
            return result;
        }

        function updateLivePrice(symbol, price, previousPriceVal) {
            document.getElementById('liveSymbol').textContent = symbol.replace('USDT', '/USDT');
            document.getElementById('livePrice').textContent = '$' + price.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: price < 1 ? 6 : 2
            });
            
            if (previousPriceVal && previousPriceVal > 0) {
                const change = ((price - previousPriceVal) / previousPriceVal) * 100;
                const changeEl = document.getElementById('livePriceChange');
                const arrow = change >= 0 ? '‚ñ≤' : '‚ñº';
                changeEl.textContent = `${arrow} ${Math.abs(change).toFixed(2)}%`;
                changeEl.className = 'live-price-change ' + (change >= 0 ? 'positive' : 'negative');
                
                const banner = document.getElementById('livePriceBanner');
                if (change >= 0) {
                    banner.style.background = 'linear-gradient(135deg, #10b981 0%, #059669 100%)';
                } else {
                    banner.style.background = 'linear-gradient(135deg, #ef4444 0%, #dc2626 100%)';
                }
            }
        }

        function calculateTradePlan(entryPrice, signalType) {
            const modal = parseFloat(document.getElementById('modal').value);
            const leverage = parseFloat(document.getElementById('leverage').value);
            const entry1Pct = parseFloat(document.getElementById('entry1-pct').value);
            const entry2Pct = parseFloat(document.getElementById('entry2-pct').value);
            const entry3Pct = parseFloat(document.getElementById('entry3-pct').value);
            const slPct = parseFloat(document.getElementById('sl-percent').value);

            // Validate entry percentages
            const totalEntryPct = entry1Pct + entry2Pct + entry3Pct;
            if (totalEntryPct !== 100) {
                alert('Total Entry % harus 100%! Sekarang: ' + totalEntryPct + '%');
                return;
            }

            const isLong = signalType.includes('BUY');

            // Calculate entries
            const entry1Size = (modal * entry1Pct / 100) * leverage;
            const entry2Size = (modal * entry2Pct / 100) * leverage;
            const entry3Size = (modal * entry3Pct / 100) * leverage;
            const totalPosition = entry1Size + entry2Size + entry3Size;

            // Entry prices (for averaging)
            const entry1Price = entryPrice;
            const entry2Price = isLong ? entryPrice * 0.99 : entryPrice * 1.01; // -1% for long, +1% for short
            const entry3Price = isLong ? entryPrice * 0.98 : entryPrice * 1.02; // -2% for long, +2% for short

            // Calculate average entry
            const avgEntry = (entry1Price * entry1Size + entry2Price * entry2Size + entry3Price * entry3Size) / totalPosition;

            // TP levels (1%, 2%, 3%, 5%, 8%)
            const tpLevels = [1, 2, 3, 5, 8];
            const tpPrices = tpLevels.map(pct => isLong ? avgEntry * (1 + pct / 100) : avgEntry * (1 - pct / 100));
            
            // SL
            const slPrice = isLong ? avgEntry * (1 - slPct / 100) : avgEntry * (1 + slPct / 100);

            // Calculate profits
            const tpProfits = tpPrices.map(tp => {
                const pnl = ((tp - avgEntry) / avgEntry) * totalPosition * (isLong ? 1 : -1);
                return pnl;
            });

            const slLoss = ((slPrice - avgEntry) / avgEntry) * totalPosition * (isLong ? 1 : -1);

            // Liquidation price (approximate)
            const liqPrice = isLong ? avgEntry * (1 - (1 / leverage) * 0.9) : avgEntry * (1 + (1 / leverage) * 0.9);
            const liqDistance = Math.abs(((liqPrice - entryPrice) / entryPrice) * 100);

            // Risk percentage
            const riskPct = Math.abs((slLoss / modal) * 100);

            // Update UI
            document.getElementById('entry-type').textContent = isLong ? 'LONG POSITION' : 'SHORT POSITION';

            // Entries
            document.getElementById('entry1-price').textContent = '$' + entry1Price.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('entry1-size').textContent = '$' + entry1Size.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('entry1-pct-display').textContent = entry1Pct + '%';

            document.getElementById('entry2-price').textContent = '$' + entry2Price.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('entry2-size').textContent = '$' + entry2Size.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('entry2-pct-display').textContent = entry2Pct + '%';

            document.getElementById('entry3-price').textContent = '$' + entry3Price.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('entry3-size').textContent = '$' + entry3Size.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('entry3-pct-display').textContent = entry3Pct + '%';

            // TPs
            const tpNames = ['tp1', 'tp2', 'tp3', 'tp4', 'tp5'];
            tpNames.forEach((name, i) => {
                document.getElementById(name + '-price').textContent = '$' + tpPrices[i].toLocaleString('en-US', {maximumFractionDigits: 2});
                document.getElementById(name + '-profit').textContent = '+$' + tpProfits[i].toFixed(2) + ' (+' + ((tpProfits[i] / modal) * 100).toFixed(2) + '% ROI)';
            });

            // SL
            document.getElementById('sl-price').textContent = '$' + slPrice.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('sl-loss').textContent = 'Loss: -$' + Math.abs(slLoss).toFixed(2) + ' (' + ((slLoss / modal) * 100).toFixed(2) + '% of Capital)';

            // Risk Management
            document.getElementById('total-position').textContent = '$' + totalPosition.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('effective-leverage').textContent = leverage + 'x';
            document.getElementById('max-loss').textContent = '-$' + Math.abs(slLoss).toFixed(2);
            document.getElementById('risk-pct').textContent = riskPct.toFixed(2) + '%';
            document.getElementById('liq-price').textContent = '$' + liqPrice.toLocaleString('en-US', {maximumFractionDigits: 2});
            document.getElementById('liq-distance').textContent = liqDistance.toFixed(2) + '%';

            // Risk warning
            const riskWarning = document.getElementById('risk-warning');
            const riskWarningMsg = document.getElementById('risk-warning-msg');
            
            if (riskPct > 5) {
                riskWarning.style.display = 'block';
                riskWarningMsg.textContent = `EXTREME RISK! Kamu bakal loss ${riskPct.toFixed(2)}% modal kalo kena SL. Ini >5% = SANGAT BERBAHAYA! Kecilkan leverage atau perbesar SL distance!`;
                document.getElementById('risk-pct').parentElement.className = 'risk-item danger';
            } else if (riskPct > 2) {
                riskWarning.style.display = 'block';
                riskWarningMsg.textContent = `MEDIUM RISK! Risk ${riskPct.toFixed(2)}% modal. Lebih dari 2% tapi masih acceptable. Hati-hati!`;
                document.getElementById('risk-pct').parentElement.className = 'risk-item warning';
            } else {
                riskWarning.style.display = 'none';
                document.getElementById('risk-pct').parentElement.className = 'risk-item safe';
            }

            if (liqDistance < 5) {
                if (!riskWarning.style.display || riskWarning.style.display === 'none') {
                    riskWarning.style.display = 'block';
                }
                riskWarningMsg.textContent += ' LIQUIDATION TERLALU DEKAT! Hanya ' + liqDistance.toFixed(2) + '% dari entry. Kecilkan leverage ASAP!';
            }

            // Show all sections
            document.getElementById('entries-box').style.display = 'block';
            document.getElementById('tp-box').style.display = 'block';
            document.getElementById('sl-box').style.display = 'block';
            document.getElementById('risk-box').style.display = 'block';
        }

        async function updateChart() {
            kLength = parseInt(document.getElementById('k-length').value);
            kSmooth = parseInt(document.getElementById('k-smooth').value);
            dSmooth = parseInt(document.getElementById('d-smooth').value);
            const symbol = document.getElementById('symbol').value;
            const timeframe = document.getElementById('timeframe').value;

            document.getElementById('display-k-length').textContent = kLength;
            document.getElementById('display-k-smooth').textContent = kSmooth;
            document.getElementById('display-d-smooth').textContent = dSmooth;
            document.getElementById('display-timeframe').textContent = timeframe.toUpperCase();

            try {
                const priceData = await fetchBinanceData(symbol, timeframe, 100);
                previousPrice = priceData.length > 1 ? priceData[priceData.length - 2].close : 0;
                currentPrice = priceData[priceData.length - 1].close;
                
                updateLivePrice(symbol, currentPrice, previousPrice);
                
                const stoch = calculateStochastic(priceData, kLength, kSmooth, dSmooth);

                const labels = Array.from({ length: stoch.k.length }, (_, i) => {
                    const date = priceData[priceData.length - stoch.k.length + i].time;
                    return date.toLocaleString('id-ID', { 
                        month: 'short', 
                        day: 'numeric',
                        hour: timeframe.includes('m') || timeframe.includes('h') ? '2-digit' : undefined,
                        minute: timeframe.includes('m') ? '2-digit' : undefined
                    });
                });

                const kCurrent = stoch.k[stoch.k.length - 1].toFixed(2);
                const dCurrent = stoch.d[stoch.d.length - 1].toFixed(2);
                const kPrevious = stoch.k[stoch.k.length - 2].toFixed(2);
                const dPrevious = stoch.d[stoch.d.length - 2].toFixed(2);

                const bullishCross = kPrevious < dPrevious && kCurrent > dCurrent;
                const bearishCross = kPrevious > dPrevious && kCurrent < dCurrent;

                document.getElementById('k-value').textContent = kCurrent;
                document.getElementById('d-value').textContent = dCurrent;

                let zone = 'NEUTRAL';
                let zoneClass = 'neutral';
                let zoneEmoji = '‚öñÔ∏è';
                let tradeAction = '';
                let tradeReason = '';
                let tradeClass = 'hold-signal';
                
                if (kCurrent < 20 && bullishCross) {
                    tradeAction = 'üöÄ STRONG BUY';
                    tradeReason = 'Oversold + %K potong %D ke atas = Momentum naik kuat! Good entry point!';
                    tradeClass = 'buy-signal';
                    zone = 'OVERSOLD';
                    zoneClass = 'oversold';
                    zoneEmoji = 'üü¢';
                    currentSignalType = 'STRONG BUY';
                } else if (kCurrent < 20) {
                    tradeAction = 'üìà BUY';
                    tradeReason = 'Harga di zona oversold (murah). Tunggu konfirmasi crossing untuk entry lebih aman.';
                    tradeClass = 'buy-signal';
                    zone = 'OVERSOLD';
                    zoneClass = 'oversold';
                    zoneEmoji = 'üü¢';
                    currentSignalType = 'BUY';
                } else if (kCurrent > 80 && bearishCross) {
                    tradeAction = 'üí• STRONG SELL';
                    tradeReason = 'Overbought + %K potong %D ke bawah = Momentum turun kuat! Good exit point!';
                    tradeClass = 'sell-signal';
                    zone = 'OVERBOUGHT';
                    zoneClass = 'overbought';
                    zoneEmoji = 'üî¥';
                    currentSignalType = 'STRONG SELL';
                } else if (kCurrent > 80) {
                    tradeAction = 'üìâ SELL';
                    tradeReason = 'Harga di zona overbought (mahal). Tunggu konfirmasi crossing untuk exit lebih aman.';
                    tradeClass = 'sell-signal';
                    zone = 'OVERBOUGHT';
                    zoneClass = 'overbought';
                    zoneEmoji = 'üî¥';
                    currentSignalType = 'SELL';
                } else if (bullishCross) {
                    tradeAction = '‚úÖ BUY';
                    tradeReason = '%K memotong %D ke atas = Sinyal bullish. Momentum mulai naik.';
                    tradeClass = 'buy-signal';
                    currentSignalType = 'BUY';
                } else if (bearishCross) {
                    tradeAction = '‚ùå SELL';
                    tradeReason = '%K memotong %D ke bawah = Sinyal bearish. Momentum mulai turun.';
                    tradeClass = 'sell-signal';
                    currentSignalType = 'SELL';
                } else {
                    tradeAction = '‚è∏Ô∏è HOLD';
                    tradeReason = 'Belum ada sinyal jelas. Tunggu dulu, jangan FOMO! Sabar adalah kunci.';
                    tradeClass = 'hold-signal';
                    currentSignalType = 'HOLD';
                }

                document.getElementById('trade-action').textContent = tradeAction;
                document.getElementById('trade-action').className = `trade-action ${tradeClass}`;
                document.getElementById('trade-reason').textContent = tradeReason;

                if (currentSignalType !== 'HOLD') {
                    calculateTradePlan(currentPrice, currentSignalType);
                } else {
                    document.getElementById('entries-box').style.display = 'none';
                    document.getElementById('tp-box').style.display = 'none';
                    document.getElementById('sl-box').style.display = 'none';
                    document.getElementById('risk-box').style.display = 'none';
                    document.getElementById('risk-warning').style.display = 'none';
                }

                if (kCurrent < 20) {
                    document.getElementById('k-status').textContent = 'üü¢ Oversold - Zona Beli';
                } else if (kCurrent > 80) {
                    document.getElementById('k-status').textContent = 'üî¥ Overbought - Zona Jual';
                } else {
                    document.getElementById('k-status').textContent = '‚ö™ Zona Netral';
                }

                if (kCurrent > dCurrent) {
                    document.getElementById('d-status').textContent = 'üìà %K di atas %D - Bullish';
                } else {
                    document.getElementById('d-status').textContent = 'üìâ %K di bawah %D - Bearish';
                }

                document.getElementById('zone-value').textContent = zoneEmoji + ' ' + zone;
                document.getElementById('zone-status').textContent = `Last Update: ${new Date().toLocaleTimeString('id-ID')}`;
                document.getElementById('zone-box').className = `signal zone-signal ${zoneClass}`;

                if (chart) chart.destroy();

                const ctx = document.getElementById('stochChart').getContext('2d');
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: '%K',
                                data: stoch.k,
                                borderColor: '#60a5fa',
                                backgroundColor: 'rgba(96, 165, 250, 0.1)',
                                borderWidth: 2,
                                tension: 0.4,
                                fill: false,
                                pointRadius: 0,
                                pointHoverRadius: 4
                            },
                            {
                                label: '%D',
                                data: stoch.d,
                                borderColor: '#f472b6',
                                backgroundColor: 'rgba(244, 114, 182, 0.1)',
                                borderWidth: 2,
                                tension: 0.4,
                                fill: false,
                                pointRadius: 0,
                                pointHoverRadius: 4
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    font: { size: 11, weight: 'bold' },
                                    color: '#94a3b8',
                                    padding: 10,
                                    boxWidth: 30
                                }
                            }
                        },
                        scales: {
                            y: {
                                min: 0,
                                max: 100,
                                ticks: {
                                    callback: function(value) {
                                        if (value === 20) return '20 (Oversold)';
                                        if (value === 80) return '80 (Overbought)';
                                        if (value === 0 || value === 50 || value === 100) return value;
                                        return '';
                                    },
                                    color: '#64748b',
                                    font: { size: 10 }
                                },
                                grid: {
                                    color: function(context) {
                                        if (context.tick.value === 20) return 'rgba(16, 185, 129, 1)';
                                        if (context.tick.value === 0) return 'rgba(255, 255, 255, 0.5)';
                                        if (context.tick.value === 100) return 'rgba(255, 255, 255, 0.5)';
                                        if (context.tick.value === 50) return 'rgba(255, 255, 255, 0.5)';
                                        if (context.tick.value === 80) return 'rgba(239, 68, 68, 1)';
                                        return 'rgba(51, 65, 85, 1)';
                                    },
                                    lineWidth: 2
                                }
                            },
                            x: {
                                ticks: {
                                    color: '#64748b',
                                    font: { size: 9 },
                                    maxRotation: 45,
                                    minRotation: 45
                                },
                                grid: {
                                    color: 'rgba(51, 65, 85, 0.2)'
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error updating chart:', error);
            }
        }

        // Auto-recalculate
        ['modal', 'leverage', 'entry1-pct', 'entry2-pct', 'entry3-pct', 'sl-percent'].forEach(id => {
            document.getElementById(id).addEventListener('input', () => {
                if (currentSignalType !== 'HOLD') {
                    calculateTradePlan(currentPrice, currentSignalType);
                }
            });
        });

        updateChart();
    </script>
</body>
</html>
