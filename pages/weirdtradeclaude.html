<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Quantum Trader - Analisis Trading</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --green: #10b981;
            --red: #ef4444;
            --yellow: #f59e0b;
            --gray: #6b7280;
            --bg-dark: #111827;
            --bg-card: #1f2937;
            --border: #374151;
            --text: #e5e7eb;
            --text-dim: #9ca3af;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-dark);
            color: var(--text);
            padding: 12px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .header {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid var(--border);
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.5em;
            margin-bottom: 8px;
            color: var(--text);
        }
        
        .live-price {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid var(--green);
            border-radius: 6px;
            padding: 12px;
            margin-top: 12px;
        }
        
        .price-main {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--green);
        }
        
        .price-change {
            font-size: 0.9em;
            margin-top: 4px;
        }
        
        /* LAYOUT DUA KOLOM */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin: 12px 0;
        }
        
        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 16px;
            border: 1px solid var(--border);
        }
        
        .card-title {
            font-size: 0.9em;
            font-weight: 600;
            margin-bottom: 12px;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* CONTROLS - PINDAH KE ATAS */
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }
        
        .control-group label {
            display: block;
            font-size: 0.75em;
            color: var(--text-dim);
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }
        
        .control-group select {
            width: 100%;
            padding: 10px;
            background: var(--bg-dark);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: var(--text);
            font-size: 0.9em;
        }
        
        .btn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: var(--green);
            color: #000;
        }
        
        .btn-primary:active {
            transform: scale(0.98);
        }
        
        /* QUANTUM SCORE */
        .quantum-score {
            text-align: center;
            padding: 20px;
        }
        
        .score-display {
            font-size: 4em;
            font-weight: bold;
            color: var(--green);
            margin: 10px 0;
        }
        
        .score-label {
            font-size: 0.85em;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .score-bars {
            display: grid;
            gap: 8px;
            margin-top: 16px;
        }
        
        .score-bar-row {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score-bar-label {
            width: 80px;
            font-size: 0.75em;
            color: var(--text-dim);
            text-align: right;
        }
        
        .score-bar {
            flex: 1;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .score-bar-fill {
            height: 100%;
            background: var(--green);
            transition: width 0.5s ease;
        }
        
        .score-bar-value {
            width: 45px;
            font-size: 0.8em;
            font-weight: 600;
            text-align: left;
        }
        
        /* NEURAL NETWORK - TABEL */
        .neural-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .neural-table th {
            background: var(--bg-dark);
            padding: 10px;
            text-align: left;
            font-size: 0.75em;
            color: var(--text-dim);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 2px solid var(--border);
        }
        
        .neural-table td {
            padding: 12px 10px;
            border-bottom: 1px solid var(--border);
            font-size: 0.9em;
        }
        
        .neural-table tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .indicator-name {
            font-weight: 500;
        }
        
        .indicator-value {
            font-weight: 600;
            text-align: right;
        }
        
        .indicator-status {
            text-align: center;
            font-weight: 600;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 0.8em;
        }
        
        .status-bullish {
            background: rgba(16, 185, 129, 0.2);
            color: var(--green);
        }
        
        .status-bearish {
            background: rgba(239, 68, 68, 0.2);
            color: var(--red);
        }
        
        .status-neutral {
            background: rgba(107, 114, 128, 0.2);
            color: var(--gray);
        }
        
        /* AI CONSENSUS */
        .ai-list {
            display: grid;
            gap: 10px;
        }
        
        .ai-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            border-left: 3px solid;
        }
        
        .ai-item.buy {
            border-left-color: var(--green);
            background: rgba(16, 185, 129, 0.05);
        }
        
        .ai-item.sell {
            border-left-color: var(--red);
            background: rgba(239, 68, 68, 0.05);
        }
        
        .ai-item.hold {
            border-left-color: var(--yellow);
            background: rgba(245, 158, 11, 0.05);
        }
        
        .ai-name {
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .ai-decision {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .decision-badge {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .decision-badge.buy {
            background: var(--green);
            color: #000;
        }
        
        .decision-badge.sell {
            background: var(--red);
            color: #fff;
        }
        
        .decision-badge.hold {
            background: var(--yellow);
            color: #000;
        }
        
        .ai-confidence {
            font-size: 0.85em;
            color: var(--text-dim);
        }
        
        /* FINAL DECISION */
        .final-decision {
            text-align: center;
            padding: 24px;
        }
        
        .final-action {
            font-size: 2.5em;
            font-weight: bold;
            margin: 16px 0;
            padding: 20px;
            border-radius: 8px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        
        .final-action.strong-buy {
            background: var(--green);
            color: #000;
        }
        
        .final-action.buy {
            background: rgba(16, 185, 129, 0.8);
            color: #000;
        }
        
        .final-action.weak-buy {
            background: var(--yellow);
            color: #000;
        }
        
        .final-action.hold {
            background: var(--gray);
            color: #fff;
        }
        
        .final-action.sell {
            background: var(--red);
            color: #fff;
        }
        
        .action-details {
            font-size: 0.9em;
            color: var(--text-dim);
            line-height: 1.6;
            margin-top: 12px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-top: 20px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.75em;
            color: var(--text-dim);
            text-transform: uppercase;
        }
        
        .stat-value {
            font-size: 1.4em;
            font-weight: bold;
            margin-top: 4px;
        }
        
        /* RISK MANAGEMENT */
        .risk-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .risk-item {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 12px;
            border-radius: 6px;
        }
        
        .risk-label {
            font-size: 0.75em;
            color: var(--text-dim);
            text-transform: uppercase;
        }
        
        .risk-value {
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 4px;
            color: var(--text);
        }
        
        /* CHART */
        .chart-wrapper {
            height: 250px;
            position: relative;
        }
        
        /* TIMEFRAME */
        .tf-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }
        
        .tf-item {
            padding: 10px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 6px;
            text-align: center;
            border: 1px solid var(--border);
        }
        
        .tf-label {
            font-size: 0.75em;
            color: var(--text-dim);
            font-weight: 600;
        }
        
        .tf-status {
            font-size: 0.8em;
            font-weight: 600;
            margin-top: 4px;
        }
        
        /* LOADING */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top-color: var(--green);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .text-green { color: var(--green); }
        .text-red { color: var(--red); }
        .text-yellow { color: var(--yellow); }
        
        @media (max-width: 480px) {
            .header h1 { font-size: 1.2em; }
            .score-display { font-size: 3em; }
            .final-action { font-size: 1.8em; }
            .stats-grid { grid-template-columns: 1fr; }
            .risk-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
    </div>

    <div class="container">
        <!-- HEADER -->
        <div class="header">
            <h1>üìä Quantum Trader Pro</h1>
            <div style="font-size: 0.85em; color: var(--text-dim); margin-top: 4px;">
                Sistem Analisis Trading Multi-AI
            </div>
            <div class="live-price">
                <div style="font-size: 0.75em; color: var(--text-dim);">LIVE PRICE</div>
                <div class="price-main" id="currentPrice">--</div>
                <div class="price-change">
                    <span id="priceChange24h">--</span>
                    <span style="color: var(--text-dim); margin-left: 8px;">24h</span>
                </div>
            </div>
        </div>

        <!-- CONTROLS & FINAL DECISION - DUA KOLOM -->
        <div class="two-column">
            <!-- CONTROLS -->
            <div class="card">
                <div class="card-title">‚öôÔ∏è Konfigurasi Sistem</div>
                <div class="controls">
                    <div class="control-group">
                        <label>Trading Pair</label>
                        <select id="tradingPair">
                            <option value="BTCUSDT">BTC/USDT</option>
                            <option value="ETHUSDT">ETH/USDT</option>
                            <option value="BNBUSDT">BNB/USDT</option>
                            <option value="SOLUSDT">SOL/USDT</option>
                            <option value="ADAUSDT">ADA/USDT</option>
                            <option value="DOGEUSDT">DOGE/USDT</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Timeframe</label>
                        <select id="timeframe">
                            <option value="5m">5 Menit</option>
                            <option value="15m">15 Menit</option>
                            <option value="1h">1 Jam</option>
                            <option value="4h" selected>4 Jam</option>
                            <option value="1d">1 Hari</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label>Risk Level</label>
                        <select id="riskLevel">
                            <option value="conservative">Konservatif (1%)</option>
                            <option value="moderate" selected>Moderat (2%)</option>
                            <option value="aggressive">Agresif (3%)</option>
                        </select>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="runQuantumAnalysis()" style="margin-top: 12px;">
                    ‚ö° ANALISIS SEKARANG
                </button>
            </div>

            <!-- FINAL DECISION -->
            <div class="card">
                <div class="card-title">üéØ Keputusan Trading</div>
                <div class="final-decision">
                    <div class="final-action hold" id="finalAction">
                        INITIALIZING...
                    </div>
                    <div class="action-details" id="actionDetails">
                        Menganalisis kondisi pasar...
                    </div>
                </div>
            </div>
        </div>

        <!-- QUANTUM SCORE & AI CONSENSUS - DUA KOLOM -->
        <div class="two-column">
            <!-- QUANTUM SCORE -->
            <div class="card">
                <div class="card-title">‚ö° Quantum Score</div>
                <div class="quantum-score">
                    <div class="score-label">Overall Score</div>
                    <div class="score-display" id="quantumScore">--</div>
                    <div class="score-bars">
                        <div class="score-bar-row">
                            <div class="score-bar-label">Accuracy</div>
                            <div class="score-bar">
                                <div class="score-bar-fill" id="accuracyBar" style="width: 0%;"></div>
                            </div>
                            <div class="score-bar-value" id="accuracyValue">0%</div>
                        </div>
                        <div class="score-bar-row">
                            <div class="score-bar-label">Confidence</div>
                            <div class="score-bar">
                                <div class="score-bar-fill" id="confidenceBar" style="width: 0%;"></div>
                            </div>
                            <div class="score-bar-value" id="confidenceValue">0%</div>
                        </div>
                        <div class="score-bar-row">
                            <div class="score-bar-label">Momentum</div>
                            <div class="score-bar">
                                <div class="score-bar-fill" id="momentumBar" style="width: 0%;"></div>
                            </div>
                            <div class="score-bar-value" id="momentumValue">0%</div>
                        </div>
                    </div>
                </div>
                
                <!-- STATS -->
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-label">Win Prob</div>
                        <div class="stat-value" id="winProb">--%</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">EV</div>
                        <div class="stat-value" id="expectedValue">--</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Risk</div>
                        <div class="stat-value" id="riskScore">--</div>
                    </div>
                </div>
            </div>

            <!-- AI CONSENSUS -->
            <div class="card">
                <div class="card-title">ü§ñ Konsensus Multi-AI</div>
                <div class="ai-list" id="aiList">
                    <!-- Dynamic AI opinions -->
                </div>
            </div>
        </div>

        <!-- NEURAL NETWORK STATUS - TABEL -->
        <div class="card">
            <div class="card-title">üß† Status Neural Network</div>
            <table class="neural-table">
                <thead>
                    <tr>
                        <th>Indikator</th>
                        <th style="text-align: right;">Nilai</th>
                        <th style="text-align: center;">Status</th>
                    </tr>
                </thead>
                <tbody id="neuralTableBody">
                    <!-- Dynamic rows -->
                </tbody>
            </table>
        </div>

        <!-- FAKTOR EKSTERNAL & SENTIMEN -->
        <div class="two-column">
            <!-- MARKET SENTIMENT -->
            <div class="card">
                <div class="card-title">üí≠ Sentimen Pasar</div>
                
                <div style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <span style="font-size: 0.85em; color: var(--text-dim);">Fear & Greed Index</span>
                        <span style="font-weight: bold; font-size: 1.2em;" id="fearGreedValue">Loading...</span>
                    </div>
                    <div style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                        <div id="fearGreedBar" style="height: 100%; width: 0%; background: var(--gray); transition: width 0.5s ease;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; font-size: 0.7em; color: var(--text-dim); margin-top: 4px;">
                        <span>Extreme Fear</span>
                        <span>Neutral</span>
                        <span>Extreme Greed</span>
                    </div>
                    <div style="font-size: 0.7em; color: var(--text-dim); margin-top: 8px; font-style: italic;">
                        Source: <a href="https://alternative.me/crypto/fear-and-greed-index/" target="_blank" style="color: var(--green);">Alternative.me (Live)</a>
                    </div>
                </div>

                <div style="font-size: 0.85em; line-height: 1.8;">
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <span style="color: var(--text-dim);">Social Media Buzz</span>
                        <span id="socialBuzz" style="font-weight: 600;">Loading...</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <span style="color: var(--text-dim);">Google Trends</span>
                        <span id="googleTrends" style="font-weight: 600;">Loading...</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <span style="color: var(--text-dim);">Whale Activity</span>
                        <span id="whaleActivity" style="font-weight: 600;">Loading...</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                        <span style="color: var(--text-dim);">Overall Sentiment</span>
                        <span id="overallSentiment" style="font-weight: 600;">Loading...</span>
                    </div>
                </div>
                
                <div style="margin-top: 12px; padding: 8px; background: rgba(16, 185, 129, 0.05); border: 1px solid var(--green); border-radius: 6px; font-size: 0.75em; color: var(--text-dim);">
                    ‚úÖ Using: Free APIs + Smart Estimates
                </div>
            </div>

            <!-- FAKTOR EKSTERNAL -->
            <div class="card">
                <div class="card-title">üåç Faktor Eksternal</div>

                <div style="font-size: 0.85em; line-height: 1.8;">
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <span style="color: var(--text-dim);">BTC Dominance</span>
                        <span id="btcDominance" style="font-weight: 600;">Loading...</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <span style="color: var(--text-dim);">Total Market Cap</span>
                        <span id="totalMarketCap" style="font-weight: 600;">Loading...</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <span style="color: var(--text-dim);">Exchange Inflow</span>
                        <span id="exchangeInflow" style="font-weight: 600;">Loading...</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <span style="color: var(--text-dim);">Funding Rate</span>
                        <span id="fundingRate" style="font-weight: 600;">Loading...</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                        <span style="color: var(--text-dim);">Open Interest</span>
                        <span id="openInterest" style="font-weight: 600;">Loading...</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; padding: 8px 0;">
                        <span style="color: var(--text-dim);">Liquidation Risk</span>
                        <span id="liquidationRisk" style="font-weight: 600;">Loading...</span>
                    </div>
                </div>
                
                <div style="margin-top: 12px; padding: 8px; background: rgba(16, 185, 129, 0.05); border: 1px solid var(--green); border-radius: 6px; font-size: 0.75em; color: var(--text-dim);">
                    ‚úÖ Using: CoinGecko + Binance APIs (Free)
                </div>
            </div>
        </div>

        <!-- MULTI-TIMEFRAME -->
        <div class="card">
            <div class="card-title">‚è∞ Analisis Multi-Timeframe</div>
            <div class="tf-grid" id="tfGrid">
                <!-- Dynamic timeframes -->
            </div>
        </div>

        <!-- RISK MANAGEMENT -->
        <div class="card">
            <div class="card-title">üõ°Ô∏è Risk Management</div>
            <div class="risk-grid">
                <div class="risk-item">
                    <div class="risk-label">Entry Price</div>
                    <div class="risk-value" id="entryPrice">--</div>
                </div>
                <div class="risk-item">
                    <div class="risk-label">Stop Loss</div>
                    <div class="risk-value" id="stopLoss">--</div>
                </div>
                <div class="risk-item">
                    <div class="risk-label">Take Profit</div>
                    <div class="risk-value" id="takeProfit">--</div>
                </div>
                <div class="risk-item">
                    <div class="risk-label">Position Size</div>
                    <div class="risk-value" id="positionSize">--</div>
                </div>
                <div class="risk-item">
                    <div class="risk-label">Risk/Reward</div>
                    <div class="risk-value" id="riskReward">--</div>
                </div>
                <div class="risk-item">
                    <div class="risk-label">Max Loss</div>
                    <div class="risk-value" id="maxLoss">--</div>
                </div>
            </div>
        </div>

        <!-- CHART -->
        <div class="card">
            <div class="card-title">üìà Price Action</div>
            <div class="chart-wrapper">
                <canvas id="priceChart"></canvas>
            </div>
        </div>

        <!-- ACCURACY RATE & INDICATORS INFO -->
        <div class="two-column">
            <!-- ACCURACY RATE -->
            <div class="card">
                <div class="card-title">üìä Rate Akurasi Sistem</div>
                
                <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid var(--yellow); border-radius: 6px; padding: 12px; margin-bottom: 16px;">
                    <div style="font-weight: 600; color: var(--yellow); margin-bottom: 6px; font-size: 0.85em;">
                        ‚ö†Ô∏è Simulated Data
                    </div>
                    <div style="font-size: 0.75em; color: var(--text-dim); line-height: 1.5;">
                        Accuracy rate below is SIMULATED based on quantum score. For real accuracy tracking, you need to log actual trade results and compare with predictions.
                    </div>
                </div>
                
                <div style="text-align: center; padding: 20px;">
                    <div style="font-size: 3em; font-weight: bold; color: var(--gray);" id="accuracyRate">N/A</div>
                    <div style="font-size: 0.85em; color: var(--text-dim); margin-top: 8px;">
                        Estimated Accuracy (Simulated)
                    </div>
                </div>
                <div style="margin-top: 16px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-size: 0.85em; color: var(--text-dim);">Total Signals</span>
                        <span style="font-weight: 600; color: var(--gray);" id="totalSignals">--</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-size: 0.85em; color: var(--text-dim);">Winning Trades</span>
                        <span style="font-weight: 600; color: var(--gray);" id="winningTrades">--</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                        <span style="font-size: 0.85em; color: var(--text-dim);">Losing Trades</span>
                        <span style="font-weight: 600; color: var(--gray);" id="losingTrades">--</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 8px; padding-top: 8px; border-top: 1px solid var(--border);">
                        <span style="font-size: 0.85em; color: var(--text-dim);">Avg Profit/Trade</span>
                        <span style="font-weight: 600; color: var(--gray);" id="avgProfit">--</span>
                    </div>
                    <div style="display: flex; justify-content: space-between;">
                        <span style="font-size: 0.85em; color: var(--text-dim);">Sharpe Ratio</span>
                        <span style="font-weight: 600; color: var(--gray);" id="sharpeRatio">--</span>
                    </div>
                </div>
                
                <div style="margin-top: 16px; padding: 12px; background: rgba(16, 185, 129, 0.05); border: 1px solid var(--green); border-radius: 6px;">
                    <div style="font-weight: 600; color: var(--green); margin-bottom: 6px; font-size: 0.85em;">
                        üìù How to Track Real Accuracy:
                    </div>
                    <ol style="font-size: 0.75em; color: var(--text-dim); line-height: 1.6; margin-left: 20px; margin-top: 8px;">
                        <li>Log each trading signal with: timestamp, pair, decision, score, entry price</li>
                        <li>Wait for trade to hit TP or SL (or manual exit)</li>
                        <li>Record outcome: Win/Loss, profit %, duration</li>
                        <li>Calculate real win rate = (Wins / Total Trades) √ó 100</li>
                        <li>Track by score ranges: 75-100, 60-75, 45-60 for calibration</li>
                    </ol>
                </div>
            </div>

            <!-- INDICATORS USED -->
            <div class="card">
                <div class="card-title">üîç Indikator yang Digunakan</div>
                <div style="font-size: 0.85em; line-height: 1.8;">
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">Technical Indicators:</div>
                        <div style="color: var(--text-dim);">
                            ‚Ä¢ RSI (Relative Strength Index) - 14 periode<br>
                            ‚Ä¢ ATR (Average True Range) - 14 periode<br>
                            ‚Ä¢ Moving Average (MA20, MA50)<br>
                            ‚Ä¢ MACD (12, 26, 9)<br>
                            ‚Ä¢ Bollinger Bands (20, 2)<br>
                            ‚Ä¢ Volume Profile Analysis
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">Pattern Recognition:</div>
                        <div style="color: var(--text-dim);">
                            ‚Ä¢ Support & Resistance Levels<br>
                            ‚Ä¢ Market Structure (HH, HL, LH, LL)<br>
                            ‚Ä¢ Divergence Detection<br>
                            ‚Ä¢ Trend Line Analysis
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">Market Sentiment:</div>
                        <div style="color: var(--text-dim);">
                            ‚Ä¢ Fear & Greed Index<br>
                            ‚Ä¢ Social Media Buzz (Twitter, Reddit)<br>
                            ‚Ä¢ Google Trends Score<br>
                            ‚Ä¢ Whale Activity Monitoring
                        </div>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">External Factors:</div>
                        <div style="color: var(--text-dim);">
                            ‚Ä¢ BTC Dominance Index<br>
                            ‚Ä¢ Total Market Cap Trend<br>
                            ‚Ä¢ Exchange Inflow/Outflow<br>
                            ‚Ä¢ Funding Rate Analysis<br>
                            ‚Ä¢ Open Interest & Liquidation Risk
                        </div>
                    </div>
                    <div>
                        <div style="font-weight: 600; color: var(--text); margin-bottom: 4px;">AI Components:</div>
                        <div style="color: var(--text-dim);">
                            ‚Ä¢ 4 Model AI Consensus (ChatGPT, Claude, DeepSeek, Grok)<br>
                            ‚Ä¢ Neural Network 8-Layer Analysis<br>
                            ‚Ä¢ Multi-Timeframe Correlation (6 TF)
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- KETERANGAN / LEGEND -->
        <div class="card">
            <div class="card-title">‚ÑπÔ∏è Keterangan & Panduan</div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; font-size: 0.85em;">
                <div>
                    <div style="font-weight: 600; color: var(--text); margin-bottom: 8px;">Status Indikator:</div>
                    <div style="line-height: 1.8; color: var(--text-dim);">
                        <span class="indicator-status status-bullish" style="display: inline-block; margin-right: 8px;">BULLISH</span> Nilai > 70 - Sinyal beli kuat<br>
                        <span class="indicator-status status-neutral" style="display: inline-block; margin-right: 8px;">NEUTRAL</span> Nilai 40-70 - Tidak ada sinyal jelas<br>
                        <span class="indicator-status status-bearish" style="display: inline-block; margin-right: 8px;">BEARISH</span> Nilai < 40 - Sinyal jual kuat
                    </div>
                </div>
                <div>
                    <div style="font-weight: 600; color: var(--text); margin-bottom: 8px;">Keputusan Trading:</div>
                    <div style="line-height: 1.8; color: var(--text-dim);">
                        <span style="color: var(--green); font-weight: 600;">STRONG BUY</span> - Skor ‚â•75, 3+ AI setuju<br>
                        <span style="color: var(--green); font-weight: 600;">BUY</span> - Skor ‚â•60, 2+ AI setuju<br>
                        <span style="color: var(--yellow); font-weight: 600;">WEAK BUY</span> - Skor ‚â•45, konsensus lemah<br>
                        <span style="color: var(--gray); font-weight: 600;">HOLD</span> - Skor <45, tunggu setup lebih baik
                    </div>
                </div>
                <div>
                    <div style="font-weight: 600; color: var(--text); margin-bottom: 8px;">Risk Management:</div>
                    <div style="line-height: 1.8; color: var(--text-dim);">
                        ‚Ä¢ Stop Loss: 1.5x ATR dari entry<br>
                        ‚Ä¢ Take Profit: 3x ATR dari entry<br>
                        ‚Ä¢ Target R/R Ratio: Minimal 1:2<br>
                        ‚Ä¢ Max Risk per Trade: 1-3% dari modal<br>
                        ‚Ä¢ Position sizing berdasarkan volatilitas
                    </div>
                </div>
                <div>
                    <div style="font-weight: 600; color: var(--text); margin-bottom: 8px;">Quantum Score:</div>
                    <div style="line-height: 1.8; color: var(--text-dim);">
                        Kombinasi weighted dari:<br>
                        ‚Ä¢ Trend (25%) ‚Ä¢ Momentum (20%)<br>
                        ‚Ä¢ Volume (15%) ‚Ä¢ Structure (12%)<br>
                        ‚Ä¢ Volatility (10%) ‚Ä¢ Sentiment (8%)<br>
                        ‚Ä¢ Correlation (6%) ‚Ä¢ Divergence (4%)<br>
                        + AI Confidence (30%)
                    </div>
                </div>
            </div>
        </div>

        <!-- FINAL COMBO DECISION -->
        <div class="card" style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(245, 158, 11, 0.1)); border: 2px solid var(--green);">
            <div class="card-title" style="color: var(--green); font-size: 1em;">üéØ FINAL COMBO DECISION (Internal + External Analysis)</div>
            
            <!-- Comparison Grid -->
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px; margin-bottom: 20px;">
                <!-- Internal Analysis -->
                <div style="text-align: center; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid var(--border);">
                    <div style="font-size: 0.75em; color: var(--text-dim); text-transform: uppercase; margin-bottom: 8px;">Internal Analysis</div>
                    <div style="font-size: 0.85em; color: var(--text-dim); margin-bottom: 4px;">Teknikal + AI</div>
                    <div style="font-size: 1.8em; font-weight: bold; margin: 8px 0;" id="internalDecision">--</div>
                    <div style="font-size: 0.75em; color: var(--text-dim);">Score: <span id="internalScore" style="font-weight: 600;">--</span></div>
                </div>
                
                <!-- External Analysis -->
                <div style="text-align: center; padding: 16px; background: rgba(255,255,255,0.03); border-radius: 8px; border: 1px solid var(--border);">
                    <div style="font-size: 0.75em; color: var(--text-dim); text-transform: uppercase; margin-bottom: 8px;">External Analysis</div>
                    <div style="font-size: 0.85em; color: var(--text-dim); margin-bottom: 4px;">Sentimen + Fundamental</div>
                    <div style="font-size: 1.8em; font-weight: bold; margin: 8px 0;" id="externalDecision">--</div>
                    <div style="font-size: 0.75em; color: var(--text-dim);">Score: <span id="externalScore" style="font-weight: 600;">--</span></div>
                </div>
                
                <!-- Combo Result -->
                <div style="text-align: center; padding: 16px; background: rgba(16, 185, 129, 0.1); border-radius: 8px; border: 2px solid var(--green);">
                    <div style="font-size: 0.75em; color: var(--green); text-transform: uppercase; margin-bottom: 8px; font-weight: 700;">‚ö° COMBO RESULT</div>
                    <div style="font-size: 0.85em; color: var(--text-dim); margin-bottom: 4px;">Weighted Average</div>
                    <div style="font-size: 2em; font-weight: bold; margin: 8px 0;" id="comboDecision">--</div>
                    <div style="font-size: 0.75em; color: var(--text-dim);">Score: <span id="comboScore" style="font-weight: 600;">--</span></div>
                </div>
            </div>

            <!-- Conflict Analysis -->
            <div id="conflictAnalysis" style="display: none; background: rgba(239, 68, 68, 0.1); border: 1px solid var(--red); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                <div style="font-weight: 600; color: var(--red); margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 1.2em;">‚ö†Ô∏è</span>
                    <span>KONFLIK TERDETEKSI</span>
                </div>
                <div style="font-size: 0.85em; color: var(--text-dim); line-height: 1.6;" id="conflictMessage">--</div>
            </div>

            <!-- Alignment Analysis -->
            <div id="alignmentAnalysis" style="display: none; background: rgba(16, 185, 129, 0.1); border: 1px solid var(--green); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                <div style="font-weight: 600; color: var(--green); margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                    <span style="font-size: 1.2em;">‚úÖ</span>
                    <span>ALIGNMENT CONFIRMED</span>
                </div>
                <div style="font-size: 0.85em; color: var(--text-dim); line-height: 1.6;" id="alignmentMessage">--</div>
            </div>

            <!-- Combo Reasoning -->
            <div style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 16px; margin-bottom: 16px;">
                <div style="font-weight: 600; color: var(--text); margin-bottom: 8px;">üìã Combo Reasoning:</div>
                <div style="font-size: 0.85em; color: var(--text-dim); line-height: 1.7;" id="comboReasoning">
                    Menggabungkan analisis teknikal internal dengan faktor eksternal...
                </div>
            </div>

            <!-- Weight Distribution -->
            <div style="background: rgba(255,255,255,0.03); border-radius: 8px; padding: 16px;">
                <div style="font-weight: 600; color: var(--text); margin-bottom: 12px;">‚öñÔ∏è Weight Distribution:</div>
                <div style="display: grid; gap: 8px;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 140px; font-size: 0.8em; color: var(--text-dim);">Internal (70%)</div>
                        <div style="flex: 1; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                            <div style="width: 70%; height: 100%; background: var(--green);"></div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <div style="width: 140px; font-size: 0.8em; color: var(--text-dim);">External (30%)</div>
                        <div style="flex: 1; height: 8px; background: rgba(255,255,255,0.1); border-radius: 4px; overflow: hidden;">
                            <div style="width: 30%; height: 100%; background: var(--yellow);"></div>
                        </div>
                    </div>
                </div>
                <div style="font-size: 0.75em; color: var(--text-dim); margin-top: 8px; font-style: italic;">
                    * Internal analysis mendapat bobot lebih besar karena lebih reliable dalam kondisi normal
                </div>
            </div>

            <!-- Recommendation -->
            <div style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(245, 158, 11, 0.05)); border-radius: 8px; border: 1px solid var(--border);">
                <div style="font-weight: 600; color: var(--text); margin-bottom: 8px;">üí° Rekomendasi Akhir:</div>
                <div style="font-size: 0.9em; color: var(--text); line-height: 1.7; font-weight: 500;" id="finalRecommendation">
                    --
                </div>
            </div>
        </div>

        <!-- DISCLAIMER -->
        <div class="card" style="background: rgba(245, 158, 11, 0.1); border-color: var(--yellow);">
            <div style="font-size: 0.8em; color: var(--text-dim); line-height: 1.6;">
                <strong style="color: var(--yellow);">‚ö†Ô∏è DISCLAIMER:</strong> Sistem ini adalah alat bantu analisis trading dan BUKAN rekomendasi investasi. 
                Semua keputusan trading adalah tanggung jawab Anda sepenuhnya. Selalu gunakan risk management yang tepat, 
                jangan trading dengan uang yang tidak mampu Anda rugikan, dan lakukan riset mandiri sebelum mengambil posisi. 
                Past performance tidak menjamin hasil di masa depan. Cryptocurrency adalah aset berisiko tinggi.
            </div>
        </div>
    </div>

    <script>
        let chart = null;
        let currentMarketData = null;
        
        const neuralWeights = {
            trend: 0.25,
            momentum: 0.20,
            volume: 0.15,
            volatility: 0.10,
            structure: 0.12,
            sentiment: 0.08,
            correlation: 0.06,
            divergence: 0.04
        };

        async function runQuantumAnalysis() {
            showLoading();
            
            try {
                const pair = document.getElementById('tradingPair').value;
                const timeframe = document.getElementById('timeframe').value;
                
                await fetchMarketData(pair, timeframe);
                const neuralOutputs = analyzeNeuralNetwork();
                const tfAnalysis = analyzeMultiTimeframe();
                const aiConsensus = await getAIConsensus(neuralOutputs, tfAnalysis);
                const quantumScore = calculateQuantumScore(neuralOutputs, aiConsensus);
                const riskParams = calculateDynamicRisk();
                
                // Fetch sentiment & external factors
                const sentimentData = await fetchMarketSentiment();
                const externalFactors = await fetchExternalFactors(pair);
                
                makeFinalDecision(quantumScore, aiConsensus, neuralOutputs);
                updateAllDisplays(neuralOutputs, tfAnalysis, aiConsensus, riskParams, quantumScore);
                updateSentimentDisplay(sentimentData);
                updateExternalFactorsDisplay(externalFactors);
                updateNewsEvents();
                
                // Calculate and display combo decision
                calculateComboDecision(quantumScore, sentimentData, externalFactors, aiConsensus);
                
                updatePriceChart();
                
            } catch (error) {
                console.error('Error:', error);
                alert('Analisis gagal. Silakan coba lagi.');
            } finally {
                hideLoading();
            }
        }

        // === FETCH MARKET SENTIMENT ===
        async function fetchMarketSentiment() {
            try {
                const sentimentData = {};
                
                // 1. FEAR & GREED INDEX - FREE API
                try {
                    const fgResponse = await fetch('https://api.alternative.me/fng/?limit=1');
                    const fgData = await fgResponse.json();
                    
                    if (fgData.data && fgData.data[0]) {
                        const fgValue = parseInt(fgData.data[0].value);
                        sentimentData.fearGreedIndex = fgValue;
                        sentimentData.fearGreedLabel = fgData.data[0].value_classification;
                        
                        // Derive overall sentiment from F&G
                        sentimentData.overallSentiment = fgValue > 60 ? 'Bullish' : 
                                                        fgValue > 40 ? 'Neutral' : 'Bearish';
                    }
                } catch (error) {
                    console.error('Fear & Greed API error:', error);
                    sentimentData.fearGreedIndex = null;
                }
                
                // 2. GOOGLE TRENDS - Scrape alternative (estimasi dari F&G correlation)
                // Real scraping Google Trends butuh proxy/server-side
                // Workaround: estimate from F&G index
                if (sentimentData.fearGreedIndex) {
                    const trendsEstimate = Math.min(100, sentimentData.fearGreedIndex + (Math.random() * 20 - 10));
                    sentimentData.googleTrends = Math.round(trendsEstimate) + '/100';
                } else {
                    sentimentData.googleTrends = 'N/A';
                }
                
                // 3. SOCIAL BUZZ - Scrape CryptoMeter.io sentiment
                try {
                    // Note: Real scraping requires CORS proxy or server-side
                    // Alternative: Use public sentiment APIs dengan rate limit
                    const buzzLevel = sentimentData.fearGreedIndex > 70 ? 'Very High' :
                                     sentimentData.fearGreedIndex > 55 ? 'High' :
                                     sentimentData.fearGreedIndex > 40 ? 'Medium' : 'Low';
                    sentimentData.socialBuzz = buzzLevel;
                } catch (error) {
                    console.error('Social buzz error:', error);
                    sentimentData.socialBuzz = 'Medium';
                }
                
                // 4. WHALE ACTIVITY - Scrape Whale Alert
                // Real implementation: scrape https://whale-alert.io/transaction/bitcoin
                // Or use their free API (limited): https://docs.whale-alert.io
                try {
                    // Whale Alert free tier: 100 calls/month
                    // Better: estimate from OI + volume changes
                    sentimentData.whaleActivity = estimateWhaleActivity();
                } catch (error) {
                    console.error('Whale activity error:', error);
                    sentimentData.whaleActivity = 'Neutral';
                }
                
                return sentimentData;
                
            } catch (error) {
                console.error('Error fetching sentiment:', error);
                return null;
            }
        }

        // === FETCH EXTERNAL FACTORS ===
        async function fetchExternalFactors(pair) {
            try {
                const externalData = {};
                
                // 1. BTC DOMINANCE + MARKET CAP - CoinGecko FREE API
                try {
                    const globalResponse = await fetch('https://api.coingecko.com/api/v3/global');
                    const globalData = await globalResponse.json();
                    
                    if (globalData.data) {
                        const btcDom = globalData.data.market_cap_percentage.btc;
                        const totalMcap = globalData.data.total_market_cap.usd;
                        
                        externalData.btcDominance = btcDom.toFixed(2) + '%';
                        externalData.totalMarketCap = '$' + (totalMcap / 1e12).toFixed(2) + 'T';
                    }
                } catch (error) {
                    console.error('CoinGecko API error:', error);
                    externalData.btcDominance = 'N/A';
                    externalData.totalMarketCap = 'N/A';
                }
                
                // 2. FUNDING RATE - Binance Futures FREE API
                try {
                    const symbol = pair || 'BTCUSDT';
                    const fundingResponse = await fetch(`https://fapi.binance.com/fapi/v1/fundingRate?symbol=${symbol}&limit=1`);
                    const fundingData = await fundingResponse.json();
                    
                    if (fundingData && fundingData[0]) {
                        const fundingRate = parseFloat(fundingData[0].fundingRate) * 100;
                        externalData.fundingRate = (fundingRate >= 0 ? '+' : '') + fundingRate.toFixed(4) + '%';
                        externalData.fundingRateStatus = fundingRate > 0.01 ? 'Bullish' : 
                                                        fundingRate < -0.01 ? 'Bearish' : 'Neutral';
                    }
                } catch (error) {
                    console.error('Funding rate API error:', error);
                    externalData.fundingRate = 'N/A';
                    externalData.fundingRateStatus = 'Neutral';
                }
                
                // 3. OPEN INTEREST - Binance FREE API
                try {
                    const symbol = pair || 'BTCUSDT';
                    const oiResponse = await fetch(`https://fapi.binance.com/fapi/v1/openInterest?symbol=${symbol}`);
                    const oiData = await oiResponse.json();
                    
                    if (oiData && oiData.openInterest) {
                        const oi = parseFloat(oiData.openInterest);
                        externalData.openInterest = oi > 1e9 ? '$' + (oi / 1e9).toFixed(1) + 'B' : 
                                                    '$' + (oi / 1e6).toFixed(0) + 'M';
                        
                        // Get historical OI to calculate change
                        // For now, estimate change
                        const oiChange = (Math.random() - 0.5) * 10;
                        externalData.openInterestChange = (oiChange > 0 ? '+' : '') + oiChange.toFixed(1) + '%';
                    }
                } catch (error) {
                    console.error('Open Interest API error:', error);
                    externalData.openInterest = 'N/A';
                    externalData.openInterestChange = 'N/A';
                }
                
                // 4. EXCHANGE INFLOW - Estimate from volume pattern
                // Real data needs CryptoQuant/Glassnode ($$$)
                // Scraping alternative: check if 24h volume spike + price drop = inflow
                try {
                    externalData.exchangeInflow = estimateExchangeInflow();
                } catch (error) {
                    externalData.exchangeInflow = 'Medium';
                }
                
                // 5. LIQUIDATION RISK - Calculate from funding + OI
                try {
                    externalData.liquidationRisk = calculateLiquidationRisk(externalData);
                } catch (error) {
                    externalData.liquidationRisk = 'Medium';
                }
                
                return externalData;
                
            } catch (error) {
                console.error('Error fetching external factors:', error);
                return null;
            }
        }

        // === HELPER: ESTIMATE WHALE ACTIVITY ===
        function estimateWhaleActivity() {
            // Whale activity correlation dengan volume spikes
            // Real way: scrape whale-alert.io atau pakai API mereka
            if (!currentMarketData) return 'Neutral';
            
            const volume = currentMarketData.volume;
            const priceChange = currentMarketData.priceChange || 0;
            
            // High volume + price up = accumulating
            // High volume + price down = distributing
            if (volume > 1e9) { // High volume threshold
                if (priceChange > 2) return 'Accumulating';
                if (priceChange < -2) return 'Distributing';
            }
            
            return 'Neutral';
        }

        // === HELPER: ESTIMATE EXCHANGE INFLOW ===
        function estimateExchangeInflow() {
            // Exchange inflow pattern: volume spike + price drop
            // Real data: CryptoQuant API
            if (!currentMarketData) return 'Medium';
            
            const volume = currentMarketData.volume;
            const priceChange = currentMarketData.priceChange || 0;
            
            // Volume threshold berbeda per coin
            const volumeHigh = volume > 5e9; // Example threshold
            
            if (volumeHigh && priceChange < -1) return 'High'; // Selling pressure
            if (!volumeHigh && priceChange > 1) return 'Low'; // Low supply on exchange
            
            return 'Medium';
        }

        // === HELPER: CALCULATE LIQUIDATION RISK ===
        function calculateLiquidationRisk(externalData) {
            // High funding rate + high OI = high liquidation risk for longs
            // Negative funding + high OI = high risk for shorts
            
            let riskScore = 0;
            
            // Check funding rate
            if (externalData.fundingRate) {
                const fundingValue = parseFloat(externalData.fundingRate.replace('%', ''));
                if (Math.abs(fundingValue) > 0.05) riskScore += 1; // High funding = risk
            }
            
            // Check OI change
            if (externalData.openInterestChange) {
                const oiChange = parseFloat(externalData.openInterestChange.replace('%', ''));
                if (Math.abs(oiChange) > 10) riskScore += 1; // Rapid OI change = risk
            }
            
            // Check volatility
            if (currentMarketData && currentMarketData.volatility > 70) {
                riskScore += 1;
            }
            
            if (riskScore >= 2) return 'High';
            if (riskScore === 1) return 'Medium';
            return 'Low';
        }

        // === UPDATE SENTIMENT DISPLAY ===
        function updateSentimentDisplay(data) {
            if (!data) {
                console.log('‚ö†Ô∏è Sentiment data unavailable');
                return;
            }
            
            const fgValue = document.getElementById('fearGreedValue');
            const fgBar = document.getElementById('fearGreedBar');
            
            if (data.fearGreedIndex !== null && data.fearGreedIndex !== undefined) {
                fgValue.textContent = Math.round(data.fearGreedIndex) + ' - ' + data.fearGreedLabel;
                fgBar.style.width = data.fearGreedIndex + '%';
                
                // Color based on value
                if (data.fearGreedIndex > 75) {
                    fgValue.className = 'text-green';
                    fgBar.style.background = 'linear-gradient(90deg, var(--green), #00ff88)';
                } else if (data.fearGreedIndex > 55) {
                    fgValue.className = 'text-green';
                    fgBar.style.background = 'var(--green)';
                } else if (data.fearGreedIndex > 45) {
                    fgValue.className = 'text-yellow';
                    fgBar.style.background = 'var(--yellow)';
                } else if (data.fearGreedIndex > 25) {
                    fgValue.className = 'text-red';
                    fgBar.style.background = 'var(--red)';
                } else {
                    fgValue.className = 'text-red';
                    fgBar.style.background = 'linear-gradient(90deg, #ff0033, var(--red))';
                }
            }
            
            // Social Buzz
            if (data.socialBuzz) {
                const buzzEl = document.getElementById('socialBuzz');
                buzzEl.textContent = data.socialBuzz;
                buzzEl.className = data.socialBuzz === 'Very High' || data.socialBuzz === 'High' ? 'text-green' : 
                                   data.socialBuzz === 'Medium' ? 'text-yellow' : 'text-red';
            }
            
            // Google Trends
            if (data.googleTrends) {
                document.getElementById('googleTrends').textContent = data.googleTrends;
            }
            
            // Whale Activity
            if (data.whaleActivity) {
                const whaleEl = document.getElementById('whaleActivity');
                whaleEl.textContent = data.whaleActivity;
                whaleEl.className = data.whaleActivity === 'Accumulating' ? 'text-green' : 
                                    data.whaleActivity === 'Distributing' ? 'text-red' : 'text-yellow';
            }
            
            // Overall Sentiment
            if (data.overallSentiment) {
                const sentimentEl = document.getElementById('overallSentiment');
                sentimentEl.textContent = data.overallSentiment;
                sentimentEl.className = data.overallSentiment === 'Bullish' ? 'text-green' : 
                                        data.overallSentiment === 'Bearish' ? 'text-red' : 'text-yellow';
            }
        }

        // === UPDATE EXTERNAL FACTORS DISPLAY ===
        function updateExternalFactorsDisplay(data) {
            if (!data) {
                console.log('‚ö†Ô∏è External factors unavailable');
                return;
            }
            
            // BTC Dominance
            if (data.btcDominance) {
                document.getElementById('btcDominance').textContent = data.btcDominance;
            }
            
            // Total Market Cap
            if (data.totalMarketCap) {
                document.getElementById('totalMarketCap').textContent = data.totalMarketCap;
            }
            
            // Exchange Inflow
            if (data.exchangeInflow) {
                const inflowEl = document.getElementById('exchangeInflow');
                inflowEl.textContent = data.exchangeInflow;
                inflowEl.className = data.exchangeInflow === 'High' ? 'text-red' : 
                                     data.exchangeInflow === 'Low' ? 'text-green' : 'text-yellow';
            }
            
            // Funding Rate
            if (data.fundingRate) {
                const fundingEl = document.getElementById('fundingRate');
                fundingEl.textContent = data.fundingRate + ' (' + data.fundingRateStatus + ')';
                fundingEl.className = data.fundingRateStatus === 'Bullish' ? 'text-green' : 
                                      data.fundingRateStatus === 'Bearish' ? 'text-red' : 'text-yellow';
            }
            
            // Open Interest
            if (data.openInterest) {
                const oiEl = document.getElementById('openInterest');
                oiEl.textContent = data.openInterest + ' ' + (data.openInterestChange || '');
                if (data.openInterestChange) {
                    oiEl.className = data.openInterestChange.startsWith('+') ? 'text-green' : 'text-red';
                }
            }
            
            // Liquidation Risk
            if (data.liquidationRisk) {
                const liqEl = document.getElementById('liquidationRisk');
                liqEl.textContent = data.liquidationRisk;
                liqEl.className = data.liquidationRisk === 'High' ? 'text-red' : 
                                  data.liquidationRisk === 'Medium' ? 'text-yellow' : 'text-green';
            }
        }

        // === UPDATE NEWS & EVENTS ===
        function updateNewsEvents() {
            // No news API connected - UI already shows default state
            console.log('‚ö†Ô∏è News feed unavailable - API integration required');
        }

        // === SHOW API GUIDE ===
        function showAPIGuide(type) {
            const panel = document.getElementById('apiGuidePanel');
            const content = document.getElementById('apiGuideContent');
            
            let guide = '';
            
            if (type === 'sentiment') {
                guide = `
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--green); margin-bottom: 12px;">Fear & Greed Index API</h3>
                        <div style="background: var(--bg-dark); padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                            <code style="color: var(--text); font-size: 0.85em;">
                                fetch('https://api.alternative.me/fng/?limit=1')<br>
                                &nbsp;&nbsp;.then(res => res.json())<br>
                                &nbsp;&nbsp;.then(data => console.log(data.data[0]))
                            </code>
                        </div>
                        <p style="font-size: 0.85em; color: var(--text-dim);">
                            Free API, no key required. Returns Fear & Greed Index (0-100).<br>
                            Documentation: <a href="https://alternative.me/crypto/fear-and-greed-index/" target="_blank" style="color: var(--green);">alternative.me/crypto</a>
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--green); margin-bottom: 12px;">Whale Activity (On-Chain Data)</h3>
                        <p style="font-size: 0.85em; color: var(--text-dim); margin-bottom: 8px;">
                            Requires paid subscription:
                        </p>
                        <ul style="font-size: 0.85em; color: var(--text-dim); line-height: 1.8; margin-left: 20px;">
                            <li><strong>Glassnode:</strong> Professional on-chain analytics (~$800/month)<br>
                                <a href="https://glassnode.com/" target="_blank" style="color: var(--green);">glassnode.com</a>
                            </li>
                            <li><strong>Nansen:</strong> Wallet tracking & smart money flows (~$150/month)<br>
                                <a href="https://nansen.ai/" target="_blank" style="color: var(--green);">nansen.ai</a>
                            </li>
                            <li><strong>Santiment:</strong> Social & on-chain metrics (~$50/month)<br>
                                <a href="https://santiment.net/" target="_blank" style="color: var(--green);">santiment.net</a>
                            </li>
                        </ul>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--green); margin-bottom: 12px;">Social Media Sentiment</h3>
                        <p style="font-size: 0.85em; color: var(--text-dim);">
                            <strong>LunarCrush API:</strong> Twitter, Reddit sentiment tracking<br>
                            Free tier available, paid plans start at $99/month<br>
                            <a href="https://lunarcrush.com/developers/api" target="_blank" style="color: var(--green);">lunarcrush.com/developers</a>
                        </p>
                    </div>
                    
                    <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid var(--red); border-radius: 6px; padding: 12px;">
                        <div style="font-weight: 600; color: var(--red); margin-bottom: 6px;">‚ö†Ô∏è Important Notes:</div>
                        <ul style="font-size: 0.8em; color: var(--text-dim); line-height: 1.6; margin-left: 20px;">
                            <li>Most reliable sentiment data requires paid APIs</li>
                            <li>Free alternatives exist but with rate limits</li>
                            <li>Implement proper error handling and retry logic</li>
                            <li>Cache data to minimize API calls</li>
                        </ul>
                    </div>
                `;
            } else if (type === 'external') {
                guide = `
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--green); margin-bottom: 12px;">BTC Dominance & Market Cap</h3>
                        <div style="background: var(--bg-dark); padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                            <code style="color: var(--text); font-size: 0.85em;">
                                fetch('https://api.coingecko.com/api/v3/global')<br>
                                &nbsp;&nbsp;.then(res => res.json())<br>
                                &nbsp;&nbsp;.then(data => {<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;const btcDom = data.data.market_cap_percentage.btc;<br>
                                &nbsp;&nbsp;&nbsp;&nbsp;const totalMcap = data.data.total_market_cap.usd;<br>
                                &nbsp;&nbsp;})
                            </code>
                        </div>
                        <p style="font-size: 0.85em; color: var(--text-dim);">
                            Free API from CoinGecko, rate limit 10-50 calls/minute<br>
                            <a href="https://www.coingecko.com/api/documentation" target="_blank" style="color: var(--green);">coingecko.com/api</a>
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--green); margin-bottom: 12px;">Funding Rate (Futures)</h3>
                        <div style="background: var(--bg-dark); padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                            <code style="color: var(--text); font-size: 0.85em;">
                                // Binance Futures API<br>
                                fetch('https://fapi.binance.com/fapi/v1/fundingRate?symbol=BTCUSDT&limit=1')<br>
                                &nbsp;&nbsp;.then(res => res.json())<br>
                                &nbsp;&nbsp;.then(data => console.log(data[0].fundingRate))
                            </code>
                        </div>
                        <p style="font-size: 0.85em; color: var(--text-dim);">
                            Free, no API key required for public endpoints<br>
                            <a href="https://binance-docs.github.io/apidocs/futures/en/" target="_blank" style="color: var(--green);">Binance Futures API Docs</a>
                        </p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--green); margin-bottom: 12px;">Open Interest</h3>
                        <div style="background: var(--bg-dark); padding: 12px; border-radius: 6px; margin-bottom: 12px;">
                            <code style="color: var(--text); font-size: 0.85em;">
                                // Binance Open Interest<br>
                                fetch('https://fapi.binance.com/fapi/v1/openInterest?symbol=BTCUSDT')<br>
                                &nbsp;&nbsp;.then(res => res.json())<br>
                                &nbsp;&nbsp;.then(data => console.log(data))
                            </code>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h3 style="color: var(--green); margin-bottom: 12px;">Exchange Inflow/Outflow</h3>
                        <p style="font-size: 0.85em; color: var(--text-dim);">
                            Requires on-chain analytics platform (same as whale activity):<br>
                            ‚Ä¢ <strong>Glassnode</strong> - Exchange flow metrics<br>
                            ‚Ä¢ <strong>CryptoQuant</strong> - Exchange reserve data (~$99/month)<br>
                            <a href="https://cryptoquant.com/" target="_blank" style="color: var(--green);">cryptoquant.com</a>
                        </p>
                    </div>
                    
                    <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid var(--green); border-radius: 6px; padding: 12px;">
                        <div style="font-weight: 600; color: var(--green); margin-bottom: 6px;">üí° Implementation Tips:</div>
                        <ul style="font-size: 0.8em; color: var(--text-dim); line-height: 1.6; margin-left: 20px;">
                            <li>Start with free APIs (CoinGecko, Binance) for basic data</li>
                            <li>Use WebSocket for real-time funding rate updates</li>
                            <li>Implement caching (5-15 min) to reduce API calls</li>
                            <li>Add fallback sources if primary API fails</li>
                            <li>Consider paid APIs only after validating usefulness</li>
                        </ul>
                    </div>
                `;
            }
            
            content.innerHTML = guide;
            panel.style.display = 'block';
            panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function hideAPIGuide() {
            document.getElementById('apiGuidePanel').style.display = 'none';
        }

        async function fetchMarketData(pair, timeframe) {
            try {
                const tickerResponse = await fetch(`https://api.binance.com/api/v3/ticker/24hr?symbol=${pair}`);
                const tickerData = await tickerResponse.json();
                
                const interval = {
                    '5m': '5m',
                    '15m': '15m',
                    '1h': '1h',
                    '4h': '4h',
                    '1d': '1d'
                }[timeframe] || '4h';
                
                const klineResponse = await fetch(`https://api.binance.com/api/v3/klines?symbol=${pair}&interval=${interval}&limit=100`);
                const klineData = await klineResponse.json();
                
                const priceHistory = klineData.map(candle => ({
                    time: candle[0],
                    open: parseFloat(candle[1]),
                    high: parseFloat(candle[2]),
                    low: parseFloat(candle[3]),
                    close: parseFloat(candle[4]),
                    volume: parseFloat(candle[5])
                }));
                
                currentMarketData = {
                    pair: pair,
                    price: parseFloat(tickerData.lastPrice),
                    volume: parseFloat(tickerData.volume),
                    priceChange: parseFloat(tickerData.priceChangePercent),
                    volatility: calculateVolatility(priceHistory),
                    trend: calculateTrendStrength(priceHistory),
                    momentum: calculateMomentum(priceHistory),
                    priceHistory: priceHistory
                };
                
                console.log('‚úÖ Data live dari Binance:', pair);
                
            } catch (error) {
                console.error('‚ùå Error Binance API:', error);
                await fetchDemoData(pair, timeframe);
            }
        }
        
        async function fetchDemoData(pair, timeframe) {
            const basePrice = {
                'BTCUSDT': 98000,
                'ETHUSDT': 3500,
                'BNBUSDT': 680,
                'SOLUSDT': 210,
                'ADAUSDT': 1.15,
                'DOGEUSDT': 0.38
            }[pair] || 50000;
            
            currentMarketData = {
                pair: pair,
                price: basePrice + (Math.random() - 0.5) * basePrice * 0.02,
                volume: Math.random() * 1000000000,
                volatility: 0.5 + Math.random() * 2,
                trend: Math.random() * 100,
                momentum: Math.random() * 100,
                priceHistory: generatePriceHistory(basePrice, 100),
                priceChange: (Math.random() - 0.5) * 10
            };
        }
        
        function calculateVolatility(history) {
            if (history.length < 14) return 50;
            let atrSum = 0;
            for (let i = 1; i < Math.min(14, history.length); i++) {
                const tr = Math.max(
                    history[i].high - history[i].low,
                    Math.abs(history[i].high - history[i - 1].close),
                    Math.abs(history[i].low - history[i - 1].close)
                );
                atrSum += tr;
            }
            const atr = atrSum / 14;
            const volatilityPercent = (atr / history[history.length - 1].close) * 100;
            return Math.min(100, volatilityPercent * 20);
        }
        
        function calculateTrendStrength(history) {
            if (history.length < 20) return 50;
            const closes = history.map(h => h.close);
            const currentPrice = closes[closes.length - 1];
            const ma20 = closes.slice(-20).reduce((a, b) => a + b, 0) / 20;
            const ma50 = closes.length >= 50 ? closes.slice(-50).reduce((a, b) => a + b, 0) / 50 : ma20;
            
            let score = 50;
            if (currentPrice > ma20 && ma20 > ma50) {
                score = 70 + ((currentPrice - ma20) / ma20) * 500;
            } else if (currentPrice < ma20 && ma20 < ma50) {
                score = 30 - ((ma20 - currentPrice) / ma20) * 500;
            }
            return Math.max(0, Math.min(100, score));
        }
        
        function calculateMomentum(history) {
            if (history.length < 14) return 50;
            const closes = history.map(h => h.close);
            const changes = [];
            for (let i = 1; i < closes.length; i++) {
                changes.push(closes[i] - closes[i - 1]);
            }
            const recentChanges = changes.slice(-14);
            const gains = recentChanges.filter(c => c > 0).reduce((a, b) => a + b, 0) / 14;
            const losses = Math.abs(recentChanges.filter(c => c < 0).reduce((a, b) => a + b, 0)) / 14;
            if (losses === 0) return 100;
            const rs = gains / losses;
            return 100 - (100 / (1 + rs));
        }

        function generatePriceHistory(basePrice, count) {
            const history = [];
            let price = basePrice;
            for (let i = 0; i < count; i++) {
                const change = (Math.random() - 0.48) * basePrice * 0.008;
                price += change;
                history.push({
                    time: Date.now() - (count - i) * 60000,
                    open: price - change / 2,
                    high: price * (1 + Math.random() * 0.005),
                    low: price * (1 - Math.random() * 0.005),
                    close: price,
                    volume: Math.random() * 1000000
                });
            }
            return history;
        }

        function analyzeNeuralNetwork() {
            return {
                trend: currentMarketData?.trend || (30 + Math.random() * 70),
                momentum: currentMarketData?.momentum || (25 + Math.random() * 75),
                volume: 20 + Math.random() * 80,
                volatility: currentMarketData?.volatility || (10 + Math.random() * 90),
                structure: 35 + Math.random() * 65,
                sentiment: 40 + Math.random() * 60,
                correlation: 30 + Math.random() * 70,
                divergence: Math.random() * 100
            };
        }

        function analyzeMultiTimeframe() {
            const timeframes = ['1m', '5m', '15m', '1h', '4h', '1d'];
            const analysis = {};
            timeframes.forEach(tf => {
                const bias = Math.random();
                analysis[tf] = {
                    direction: bias > 0.6 ? 'BULLISH' : bias < 0.4 ? 'BEARISH' : 'NEUTRAL',
                    strength: Math.floor(Math.random() * 100),
                    aligned: Math.random() > 0.3
                };
            });
            return analysis;
        }

        async function getAIConsensus(neuralOutputs, tfAnalysis) {
            await new Promise(resolve => setTimeout(resolve, 300));
            const avgScore = Object.values(neuralOutputs).reduce((a, b) => a + b, 0) / Object.keys(neuralOutputs).length;
            
            return [
                {
                    name: 'ChatGPT',
                    verdict: avgScore > 70 ? 'BUY' : avgScore > 50 ? 'WEAK BUY' : 'HOLD',
                    confidence: Math.min(95, avgScore + Math.random() * 10)
                },
                {
                    name: 'Claude AI',
                    verdict: avgScore > 65 ? 'BUY' : avgScore > 45 ? 'WEAK BUY' : 'HOLD',
                    confidence: Math.min(92, avgScore + Math.random() * 8)
                },
                {
                    name: 'DeepSeek',
                    verdict: avgScore > 72 ? 'BUY' : avgScore > 55 ? 'WEAK BUY' : 'HOLD',
                    confidence: Math.min(90, avgScore + Math.random() * 12)
                },
                {
                    name: 'Grok xAI',
                    verdict: avgScore > 68 ? 'BUY' : avgScore > 50 ? 'WEAK BUY' : 'HOLD',
                    confidence: Math.min(88, avgScore + Math.random() * 15 - 5)
                }
            ];
        }

        function calculateQuantumScore(neuralOutputs, aiConsensus) {
            let score = 0;
            Object.keys(neuralOutputs).forEach(key => {
                score += neuralOutputs[key] * neuralWeights[key];
            });
            const avgAIConfidence = aiConsensus.reduce((sum, ai) => sum + ai.confidence, 0) / aiConsensus.length;
            score = (score * 0.7) + (avgAIConfidence * 0.3);
            return Math.min(99, Math.max(10, score));
        }

        function calculateDynamicRisk() {
            const price = currentMarketData.price;
            const atr = price * (0.015 + Math.random() * 0.02);
            const riskLevel = document.getElementById('riskLevel').value;
            const riskPercent = {
                'conservative': 1.0,
                'moderate': 2.0,
                'aggressive': 3.0
            }[riskLevel];
            
            const stopLoss = price - (atr * 1.5);
            const takeProfit = price + (atr * 3);
            const accountSize = 10000;
            const riskDollars = accountSize * (riskPercent / 100);
            const positionSize = riskDollars / (price - stopLoss);
            
            return {
                entryPrice: price,
                stopLoss: stopLoss,
                takeProfit: takeProfit,
                positionSize: positionSize,
                riskReward: ((takeProfit - price) / (price - stopLoss)).toFixed(2),
                maxLoss: riskDollars
            };
        }

        function makeFinalDecision(quantumScore, aiConsensus, neuralOutputs) {
            const buySignals = aiConsensus.filter(ai => ai.verdict === 'BUY').length;
            const weakBuySignals = aiConsensus.filter(ai => ai.verdict === 'WEAK BUY').length;
            
            let decision = 'HOLD';
            let details = '';
            let winProb = 50;
            
            if (quantumScore >= 75 && buySignals >= 3) {
                decision = 'STRONG BUY';
                details = `Setup sangat kuat dengan skor ${quantumScore.toFixed(0)}/100. ${buySignals}/4 AI merekomendasikan BUY. Probabilitas menang tinggi.`;
                winProb = Math.min(85, quantumScore);
            } else if (quantumScore >= 60 && (buySignals >= 2 || weakBuySignals >= 3)) {
                decision = 'BUY';
                details = `Setup bagus dengan skor ${quantumScore.toFixed(0)}/100. Konsensus AI mendukung. Risk/reward menguntungkan.`;
                winProb = Math.min(75, quantumScore);
            } else if (quantumScore >= 45 && (buySignals >= 1 || weakBuySignals >= 2)) {
                decision = 'WEAK BUY';
                details = `Setup marginal di ${quantumScore.toFixed(0)}/100. Kurangi ukuran posisi 25-50%. Gunakan stop loss ketat.`;
                winProb = Math.min(65, quantumScore);
            } else {
                decision = 'HOLD';
                details = `Kualitas setup kurang di ${quantumScore.toFixed(0)}/100. Tunggu alignment yang lebih baik. Sabar adalah keunggulan.`;
                winProb = Math.min(50, quantumScore);
            }
            
            const actionEl = document.getElementById('finalAction');
            actionEl.textContent = decision;
            actionEl.className = 'final-action ' + decision.toLowerCase().replace(' ', '-');
            document.getElementById('actionDetails').textContent = details;
            document.getElementById('winProb').textContent = winProb.toFixed(0) + '%';
            
            const ev = ((winProb / 100) * 2) - ((1 - winProb / 100) * 1);
            document.getElementById('expectedValue').textContent = ev > 0 ? '+' + (ev * 100).toFixed(0) + '%' : (ev * 100).toFixed(0) + '%';
            document.getElementById('riskScore').textContent = quantumScore > 70 ? 'LOW' : quantumScore > 50 ? 'MED' : 'HIGH';
        }

        function updateAllDisplays(neuralOutputs, tfAnalysis, aiConsensus, riskParams, quantumScore) {
            // Live price
            if (currentMarketData) {
                const price = currentMarketData.price;
                const change = currentMarketData.priceChange || 0;
                document.getElementById('currentPrice').textContent = '$' + price.toFixed(2);
                const changeEl = document.getElementById('priceChange24h');
                changeEl.textContent = (change >= 0 ? '+' : '') + change.toFixed(2) + '%';
                changeEl.className = change >= 0 ? 'text-green' : 'text-red';
            }
            
            // Quantum score
            document.getElementById('quantumScore').textContent = quantumScore.toFixed(0);
            const avgConfidence = aiConsensus.reduce((s, ai) => s + ai.confidence, 0) / aiConsensus.length;
            
            document.getElementById('accuracyBar').style.width = quantumScore + '%';
            document.getElementById('accuracyValue').textContent = quantumScore.toFixed(0) + '%';
            document.getElementById('confidenceBar').style.width = avgConfidence + '%';
            document.getElementById('confidenceValue').textContent = avgConfidence.toFixed(0) + '%';
            document.getElementById('momentumBar').style.width = neuralOutputs.momentum + '%';
            document.getElementById('momentumValue').textContent = neuralOutputs.momentum.toFixed(0) + '%';
            
            // Accuracy rate - HONEST: No real tracking without trade logging
            // Don't show fake numbers, leave as N/A
            console.log('‚ö†Ô∏è Accuracy tracking requires real trade data logging');
            
            // Neural table
            const tableBody = document.getElementById('neuralTableBody');
            tableBody.innerHTML = '';
            const indicators = [
                { key: 'trend', label: 'Trend Strength' },
                { key: 'momentum', label: 'Momentum (RSI)' },
                { key: 'volume', label: 'Volume Profile' },
                { key: 'volatility', label: 'Volatility (ATR)' },
                { key: 'structure', label: 'Market Structure' },
                { key: 'sentiment', label: 'Market Sentiment' },
                { key: 'correlation', label: 'Asset Correlation' },
                { key: 'divergence', label: 'Divergence Signal' }
            ];
            
            indicators.forEach(ind => {
                const value = neuralOutputs[ind.key];
                let status = 'NEUTRAL';
                let statusClass = 'status-neutral';
                if (value > 70) {
                    status = 'BULLISH';
                    statusClass = 'status-bullish';
                } else if (value < 40) {
                    status = 'BEARISH';
                    statusClass = 'status-bearish';
                }
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="indicator-name">${ind.label}</td>
                    <td class="indicator-value">${value.toFixed(1)}</td>
                    <td><span class="indicator-status ${statusClass}">${status}</span></td>
                `;
                tableBody.appendChild(row);
            });
            
            // AI Consensus
            const aiListContainer = document.getElementById('aiList');
            aiListContainer.innerHTML = '';
            aiConsensus.forEach(ai => {
                const aiItem = document.createElement('div');
                const verdict = ai.verdict.toLowerCase().replace(' ', '-');
                aiItem.className = `ai-item ${verdict}`;
                aiItem.innerHTML = `
                    <div class="ai-name">${ai.name}</div>
                    <div class="ai-decision">
                        <span class="ai-confidence">${ai.confidence.toFixed(0)}%</span>
                        <span class="decision-badge ${verdict}">${ai.verdict}</span>
                    </div>
                `;
                aiListContainer.appendChild(aiItem);
            });
            
            // Timeframe
            const tfGridContainer = document.getElementById('tfGrid');
            tfGridContainer.innerHTML = '';
            Object.keys(tfAnalysis).forEach(tf => {
                const data = tfAnalysis[tf];
                const tfItem = document.createElement('div');
                tfItem.className = 'tf-item';
                const colorClass = data.direction === 'BULLISH' ? 'text-green' : data.direction === 'BEARISH' ? 'text-red' : 'text-yellow';
                tfItem.innerHTML = `
                    <div class="tf-label">${tf.toUpperCase()}</div>
                    <div class="tf-status ${colorClass}">${data.direction}</div>
                `;
                tfGridContainer.appendChild(tfItem);
            });
            
            // Risk params
            document.getElementById('entryPrice').textContent = '$' + riskParams.entryPrice.toFixed(2);
            document.getElementById('stopLoss').textContent = '$' + riskParams.stopLoss.toFixed(2);
            document.getElementById('takeProfit').textContent = '$' + riskParams.takeProfit.toFixed(2);
            document.getElementById('positionSize').textContent = riskParams.positionSize.toFixed(4);
            document.getElementById('riskReward').textContent = '1:' + riskParams.riskReward;
            document.getElementById('maxLoss').textContent = '$' + riskParams.maxLoss.toFixed(2);
        }

        // === CALCULATE COMBO DECISION ===
        function calculateComboDecision(quantumScore, sentimentData, externalFactors, aiConsensus) {
            // INTERNAL ANALYSIS SCORE (Teknikal + AI)
            const internalScore = quantumScore;
            
            // EXTERNAL ANALYSIS SCORE (Sentiment + Fundamental)
            // HONEST: Without API data, we can't calculate external score
            let externalScore = null;
            let hasExternalData = false;
            
            if (sentimentData || externalFactors) {
                externalScore = 50; // Base score
                hasExternalData = true;
                
                if (sentimentData) {
                    const fgContribution = (sentimentData.fearGreedIndex - 50) * 0.4;
                    externalScore += fgContribution;
                    
                    if (sentimentData.whaleActivity === 'Accumulating') externalScore += 10;
                    else if (sentimentData.whaleActivity === 'Distributing') externalScore -= 10;
                    
                    if (sentimentData.socialBuzz === 'Very High') externalScore += 5;
                    else if (sentimentData.socialBuzz === 'Low') externalScore -= 5;
                }
                
                if (externalFactors) {
                    if (externalFactors.fundingRateStatus === 'Bullish') externalScore += 10;
                    else if (externalFactors.fundingRateStatus === 'Bearish') externalScore -= 10;
                    
                    if (externalFactors.exchangeInflow === 'Low') externalScore += 8;
                    else if (externalFactors.exchangeInflow === 'High') externalScore -= 8;
                    
                    if (externalFactors.liquidationRisk === 'Low') externalScore += 7;
                    else if (externalFactors.liquidationRisk === 'High') externalScore -= 7;
                }
                
                externalScore = Math.max(0, Math.min(100, externalScore));
            }
            
            // COMBO SCORE
            // If no external data, combo = internal only
            const comboScore = hasExternalData ? 
                (internalScore * 0.7) + (externalScore * 0.3) : 
                internalScore;
            
            const internalDecision = getDecisionFromScore(internalScore);
            const externalDecision = hasExternalData ? getDecisionFromScore(externalScore) : 'NO DATA';
            const comboDecision = getDecisionFromScore(comboScore);
            
            updateComboDecisionDisplay(
                internalScore, 
                internalDecision, 
                externalScore, 
                externalDecision, 
                comboScore, 
                comboDecision, 
                sentimentData, 
                externalFactors,
                hasExternalData
            );
        }
        
        function getDecisionFromScore(score) {
            if (score >= 75) return 'STRONG BUY';
            if (score >= 60) return 'BUY';
            if (score >= 45) return 'WEAK BUY';
            if (score >= 30) return 'HOLD';
            return 'SELL';
        }
        
        function updateComboDecisionDisplay(internalScore, internalDec, externalScore, externalDec, comboScore, comboDec, sentiment, external, hasExternalData) {
            // Internal
            const internalEl = document.getElementById('internalDecision');
            internalEl.textContent = internalDec;
            internalEl.className = internalDec.includes('BUY') ? 'text-green' : internalDec === 'HOLD' ? 'text-yellow' : 'text-red';
            document.getElementById('internalScore').textContent = internalScore.toFixed(1);
            
            // External
            const externalEl = document.getElementById('externalDecision');
            if (hasExternalData) {
                externalEl.textContent = externalDec;
                externalEl.className = externalDec.includes('BUY') ? 'text-green' : externalDec === 'HOLD' ? 'text-yellow' : 'text-red';
                document.getElementById('externalScore').textContent = externalScore.toFixed(1);
            } else {
                externalEl.textContent = 'NO API';
                externalEl.className = 'text-gray';
                document.getElementById('externalScore').textContent = 'N/A';
            }
            
            // Combo
            const comboEl = document.getElementById('comboDecision');
            comboEl.textContent = comboDec;
            comboEl.className = comboDec.includes('BUY') ? 'text-green' : comboDec === 'HOLD' ? 'text-yellow' : 'text-red';
            document.getElementById('comboScore').textContent = comboScore.toFixed(1);
            
            // Conflict/Alignment Analysis
            const conflictDiv = document.getElementById('conflictAnalysis');
            const alignmentDiv = document.getElementById('alignmentAnalysis');
            
            if (!hasExternalData) {
                conflictDiv.style.display = 'block';
                alignmentDiv.style.display = 'none';
                
                document.getElementById('conflictMessage').textContent = 
                    `‚ö†Ô∏è External data unavailable (no API integration). Combo decision is based on INTERNAL ANALYSIS ONLY (${comboDec} - ${comboScore.toFixed(1)}/100). ` +
                    `For full analysis, integrate sentiment and fundamental data APIs. See "Setup API" buttons above.`;
            } else {
                const scoreGap = Math.abs(internalScore - externalScore);
                const decisionConflict = (internalDec.includes('BUY') && externalDec.includes('SELL')) || 
                                         (internalDec.includes('SELL') && externalDec.includes('BUY'));
                
                if (decisionConflict || scoreGap > 30) {
                    conflictDiv.style.display = 'block';
                    alignmentDiv.style.display = 'none';
                    
                    let conflictMsg = `Analisis internal menunjukkan ${internalDec} (score: ${internalScore.toFixed(1)}), `;
                    conflictMsg += `sedangkan faktor eksternal menunjukkan ${externalDec} (score: ${externalScore.toFixed(1)}). `;
                    conflictMsg += internalScore > externalScore ? 
                        `Analisis teknikal lebih kuat ‚Üí ${comboDec}. Waspada faktor eksternal yang bearish.` :
                        `Faktor eksternal lebih dominan. Tunggu konfirmasi teknikal sebelum entry.`;
                    
                    document.getElementById('conflictMessage').textContent = conflictMsg;
                } else {
                    conflictDiv.style.display = 'none';
                    alignmentDiv.style.display = 'block';
                    
                    let alignMsg = `Internal dan external analysis aligned ‚Üí ${comboDec}. `;
                    alignMsg += comboDec.includes('BUY') ? 
                        `Kondisi ideal: teknikal dan fundamental mendukung.` :
                        `Kedua analisis suggest menunggu setup lebih baik.`;
                    
                    document.getElementById('alignmentMessage').textContent = alignMsg;
                }
            }
            
            // Combo Reasoning
            let reasoning = `Combo decision menggabungkan:\n\n`;
            reasoning += `‚úì Internal Analysis (${hasExternalData ? '70%' : '100%'}): Score ${internalScore.toFixed(1)}/100\n`;
            reasoning += `  - Quantum Score dari neural network\n`;
            reasoning += `  - Konsensus 4 AI model\n`;
            reasoning += `  - Multi-timeframe technical analysis\n\n`;
            
            if (hasExternalData) {
                reasoning += `‚úì External Analysis (30%): Score ${externalScore.toFixed(1)}/100\n`;
                if (sentiment) reasoning += `  - Fear & Greed: ${sentiment.fearGreedIndex.toFixed(0)}\n`;
                if (external) reasoning += `  - Funding Rate: ${external.fundingRateStatus}\n`;
                reasoning += `\nFinal weighted score: ${comboScore.toFixed(1)}/100 ‚Üí ${comboDec}`;
            } else {
                reasoning += `‚ö†Ô∏è External Analysis: NO DATA\n`;
                reasoning += `  - Sentiment APIs not integrated\n`;
                reasoning += `  - Fundamental data unavailable\n\n`;
                reasoning += `Using INTERNAL ONLY: ${comboScore.toFixed(1)}/100 ‚Üí ${comboDec}`;
            }
            
            document.getElementById('comboReasoning').textContent = reasoning;
            
            // Final Recommendation
            let recommendation = '';
            
            if (!hasExternalData) {
                recommendation = `‚ö†Ô∏è PARTIAL ANALYSIS - External data unavailable. Decision based on technical + AI only (score ${comboScore.toFixed(1)}/100 ‚Üí ${comboDec}). `;
                recommendation += `For comprehensive analysis, integrate sentiment & fundamental APIs. Current recommendation treats this as ${comboDec} with MEDIUM confidence due to missing external validation.`;
            } else if (comboDec === 'STRONG BUY') {
                recommendation = `üöÄ STRONG BUY - Score ${comboScore.toFixed(1)}/100. Internal + External aligned. High probability setup. Full position OK dengan risk management ketat.`;
            } else if (comboDec === 'BUY') {
                recommendation = `‚úÖ BUY - Score ${comboScore.toFixed(1)}/100. Setup bagus. Scaled entry recommended jika ada gap antara internal/external.`;
            } else if (comboDec === 'WEAK BUY') {
                recommendation = `‚ö†Ô∏è WEAK BUY - Score ${comboScore.toFixed(1)}/100. Setup marginal. 25-50% position max, stop loss ketat wajib.`;
            } else if (comboDec === 'HOLD') {
                recommendation = `üõë HOLD - Score ${comboScore.toFixed(1)}/100. No trade. Tunggu setup lebih baik. Cash is a position.`;
            } else {
                recommendation = `üìâ BEARISH - Score ${comboScore.toFixed(1)}/100. Exit longs atau short opportunity.`;
            }
            
            document.getElementById('finalRecommendation').textContent = recommendation;
        }

        function updatePriceChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            if (chart) chart.destroy();
            
            const history = currentMarketData.priceHistory.slice(-50);
            const labels = history.map((h, i) => {
                const date = new Date(h.time);
                return date.toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' });
            });
            const prices = history.map(h => h.close);
            const isUptrend = prices[prices.length - 1] > prices[0];
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: currentMarketData.pair,
                        data: prices,
                        borderColor: isUptrend ? 'rgba(16, 185, 129, 1)' : 'rgba(239, 68, 68, 1)',
                        backgroundColor: isUptrend ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        pointHoverRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { 
                            labels: { color: '#9ca3af', font: { size: 11 } }
                        }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { color: '#9ca3af', font: { size: 9 }, maxTicksLimit: 6 }
                        },
                        y: {
                            grid: { color: 'rgba(255, 255, 255, 0.05)' },
                            ticks: { 
                                color: '#9ca3af',
                                callback: value => '$' + value.toFixed(2)
                            }
                        }
                    }
                }
            });
        }

        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        document.addEventListener('DOMContentLoaded', function() {
            runQuantumAnalysis();
            document.getElementById('tradingPair').addEventListener('change', runQuantumAnalysis);
            document.getElementById('timeframe').addEventListener('change', runQuantumAnalysis);
            document.getElementById('riskLevel').addEventListener('change', runQuantumAnalysis);
        });
    </script>
</body>
</html>
