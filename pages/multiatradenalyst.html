<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MASTER TRADER SYSTEM v2 - Akurasi Tinggi</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --success: #059669;
            --danger: #dc2626;
            --warning: #d97706;
            --dark: #0f172a;
            --darker: #020617;
        }
        * {
            margin: 0; padding: 0; box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        body {
            font-family: -apple-system, system-ui, sans-serif;
            background: var(--darker);
            color: #e2e8f0;
            padding: 10px;
            min-height: 100vh;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: var(--dark);
            border-radius: 12px;
            padding: 15px;
        }
        h1 { text-align: center; color: #60a5fa; margin: 10px 0; }
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%);
            color: white; padding: 4px 10px; border-radius: 20px;
            font-size: 0.7em; margin-left: 8px;
        }
        
        /* STATUS UTAMA */
        .status-main {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 15px; border-radius: 10px; margin: 15px 0;
            border: 2px solid #10b981;
        }
        .status-header {
            display: flex; justify-content: space-between;
            align-items: center; margin-bottom: 15px;
        }
        .score-box {
            background: rgba(16, 185, 129, 0.2);
            padding: 8px 15px; border-radius: 20px;
            font-weight: bold; color: #10b981;
        }
        .status-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }
        .status-item {
            background: rgba(30, 41, 59, 0.8);
            padding: 12px; border-radius: 8px;
            text-align: center; border: 1px solid #334155;
        }
        .status-label { font-size: 0.8em; color: #94a3b8; margin-bottom: 5px; }
        .status-value { font-size: 1.1em; font-weight: bold; }
        
        /* MATRIX KONFIRMASI 6 FAKTOR */
        .confirmation-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 10px; margin: 15px 0;
        }
        @media (max-width: 640px) {
            .confirmation-grid { grid-template-columns: repeat(2, 1fr); }
        }
        .confirmation-item {
            background: #1e293b; padding: 12px; border-radius: 8px;
            text-align: center; border: 2px solid;
        }
        .confirmed { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
        .rejected { border-color: #ef4444; background: rgba(239, 68, 68, 0.1); }
        .waiting { border-color: #f59e0b; background: rgba(245, 158, 11, 0.1); }
        .confirmation-title { font-size: 0.8em; margin: 5px 0; }
        .confirmation-status {
            font-size: 0.7em; padding: 3px 8px; border-radius: 10px;
            display: inline-block; margin-top: 5px;
        }
        
        /* ANALISIS MULTI TIMEFRAME */
        .timeframe-analysis {
            background: rgba(30, 41, 59, 0.8);
            padding: 15px; border-radius: 10px; margin: 15px 0;
            border: 2px solid #8b5cf6;
        }
        .timeframe-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px; margin-top: 10px;
        }
        .tf-item {
            background: #0f172a; padding: 10px; border-radius: 6px;
            text-align: center;
        }
        .tf-label { font-size: 0.8em; color: #94a3b8; }
        .tf-value { font-size: 1em; font-weight: bold; margin: 5px 0; }
        
        /* RISK MANAGEMENT */
        .risk-panel {
            background: rgba(239, 68, 68, 0.1);
            padding: 15px; border-radius: 10px; margin: 15px 0;
            border: 2px solid #ef4444;
        }
        .risk-calc {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px; margin: 15px 0;
        }
        .risk-box {
            background: rgba(30, 41, 59, 0.8); padding: 12px;
            border-radius: 8px; text-align: center;
            border: 1px solid #ef4444;
        }
        
        /* FINAL DECISION DENGAN STATISTIK */
        .final-decision {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            padding: 20px; border-radius: 10px; margin: 20px 0;
            text-align: center; border: 3px solid;
            animation: pulseBorder 2s infinite;
        }
        @keyframes pulseBorder {
            0%, 100% { border-color: #10b981; }
            50% { border-color: #3b82f6; }
        }
        .decision-action {
            font-size: 2em; font-weight: bold; margin: 15px 0;
            padding: 15px; border-radius: 10px;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .decision-buy {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white; animation: pulse 1.5s infinite;
        }
        .decision-sell {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white; animation: pulse 1.5s infinite;
        }
        .decision-hold {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }
        .stats-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px; margin-top: 20px;
        }
        
        /* KONTROL */
        .controls {
            background: #0f172a; padding: 15px;
            border-radius: 8px; margin-top: 15px;
        }
        .input-group {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px; margin: 15px 0;
        }
        .input-field {
            display: flex; flex-direction: column;
        }
        .input-field label {
            font-size: 0.8em; color: #94a3b8; margin-bottom: 5px;
        }
        .input-field select, .input-field input {
            padding: 10px; border: 1px solid #334155;
            border-radius: 6px; background: #1e293b;
            color: #f1f5f9; font-size: 0.9em;
        }
        button {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            color: white; border: none; padding: 12px;
            border-radius: 6px; font-weight: bold;
            width: 100%; cursor: pointer; margin: 10px 0;
        }
        .btn-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        /* CHART */
        .chart-container {
            height: 250px; margin: 15px 0;
            background: #0f172a; padding: 10px;
            border-radius: 8px;
        }
        
        /* UTILITY */
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        .neutral { color: #f59e0b; }
        .pill {
            display: inline-block; padding: 3px 10px;
            border-radius: 20px; font-size: 0.75em;
        }
        .green { background: rgba(16, 185, 129, 0.2); color: #10b981; }
        .red { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .yellow { background: rgba(245, 158, 11, 0.2); color: #f59e0b; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéØ MASTER TRADER SYSTEM v2 <span class="badge">AKURASI TINGGI</span></h1>
        <p style="text-align: center; color: #94a3b8; margin-bottom: 20px;">
            Sistem 6 Konfirmasi dengan Risk Management Ketat + 3 AI Analysis
        </p>
        
        <!-- STATUS UTAMA -->
        <div class="status-main">
            <div class="status-header">
                <h2>üìä STATUS SISTEM</h2>
                <div class="score-box" id="system-score">--/100</div>
            </div>
            <div class="status-grid">
                <div class="status-item">
                    <div class="status-label">Kondisi Market</div>
                    <div class="status-value" id="market-condition">--</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Akurasi Sistem</div>
                    <div class="status-value" id="system-accuracy">--%</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Risiko Level</div>
                    <div class="status-value" id="risk-level">LOW</div>
                </div>
                <div class="status-item">
                    <div class="status-label">Win Rate Estimasi</div>
                    <div class="status-value" id="win-rate">--%</div>
                </div>
            </div>
        </div>
        
        <!-- MATRIX KONFIRMASI 6 FAKTOR -->
        <h3 style="color: #3b82f6; margin: 20px 0 10px;">‚úÖ MATRIX KONFIRMASI (6/6)</h3>
        <div class="confirmation-grid">
            <div class="confirmation-item waiting" id="conf-price">
                <div>üìä</div>
                <div class="confirmation-title">Price Action</div>
                <div class="confirmation-status yellow">Menunggu</div>
            </div>
            <div class="confirmation-item waiting" id="conf-trend">
                <div>üìà</div>
                <div class="confirmation-title">Trend Multi-TF</div>
                <div class="confirmation-status yellow">Menunggu</div>
            </div>
            <div class="confirmation-item waiting" id="conf-volume">
                <div>üìâ</div>
                <div class="confirmation-title">Volume Confirmation</div>
                <div class="confirmation-status yellow">Menunggu</div>
            </div>
            <div class="confirmation-item waiting" id="conf-momentum">
                <div>‚ö°</div>
                <div class="confirmation-title">Momentum</div>
                <div class="confirmation-status yellow">Menunggu</div>
            </div>
            <div class="confirmation-item waiting" id="conf-structure">
                <div>üèõÔ∏è</div>
                <div class="confirmation-title">Market Structure</div>
                <div class="confirmation-status yellow">Menunggu</div>
            </div>
            <div class="confirmation-item waiting" id="conf-support">
                <div>üõ°Ô∏è</div>
                <div class="confirmation-title">Support/Resistance</div>
                <div class="confirmation-status yellow">Menunggu</div>
            </div>
        </div>
        
        <!-- ANALISIS MULTI TIMEFRAME -->
        <div class="timeframe-analysis">
            <h3 style="color: #8b5cf6; margin-bottom: 10px;">‚è∞ ANALISIS MULTI TIMEFRAME</h3>
            <div class="timeframe-grid">
                <div class="tf-item">
                    <div class="tf-label">Harian (1D)</div>
                    <div class="tf-value" id="tf-daily">--</div>
                    <div class="tf-label" id="tf-daily-bias">Netral</div>
                </div>
                <div class="tf-item">
                    <div class="tf-label">4 Jam (4H)</div>
                    <div class="tf-value" id="tf-4h">--</div>
                    <div class="tf-label" id="tf-4h-bias">Netral</div>
                </div>
                <div class="tf-item">
                    <div class="tf-label">1 Jam (1H)</div>
                    <div class="tf-value" id="tf-1h">--</div>
                    <div class="tf-label" id="tf-1h-bias">Netral</div>
                </div>
                <div class="tf-item">
                    <div class="tf-label">15 Menit (15M)</div>
                    <div class="tf-value" id="tf-15m">--</div>
                    <div class="tf-label" id="tf-15m-bias">Netral</div>
                </div>
            </div>
            <div style="margin-top: 15px; font-size: 0.8em; color: #94a3b8;">
                <strong>Analisis:</strong> <span id="multi-tf-analysis">Menganalisi semua timeframe...</span>
            </div>
        </div>
        
        <!-- RISK MANAGEMENT KETAT -->
        <div class="risk-panel">
            <h3 style="color: #ef4444; margin-bottom: 10px;">üõ°Ô∏è RISK MANAGEMENT KETAT</h3>
            <div class="risk-calc">
                <div class="risk-box">
                    <div style="font-size: 0.8em; color: #fca5a5;">Stop Loss</div>
                    <div style="font-size: 1.2em; font-weight: bold;" id="stop-loss">--</div>
                    <div style="font-size: 0.7em; color: #fca5a5;">Berdasarkan ATR dinamis</div>
                </div>
                <div class="risk-box">
                    <div style="font-size: 0.8em; color: #fca5a5;">Take Profit</div>
                    <div style="font-size: 1.2em; font-weight: bold;" id="take-profit">--</div>
                    <div style="font-size: 0.7em; color: #fca5a5;">Risk/Reward 1:2</div>
                </div>
                <div class="risk-box">
                    <div style="font-size: 0.8em; color: #fca5a5;">Max Risk</div>
                    <div style="font-size: 1.2em; font-weight: bold;" id="max-risk">1.5%</div>
                    <div style="font-size: 0.7em; color: #fca5a5;">Dari equity</div>
                </div>
            </div>
            <div style="margin-top: 10px; font-size: 0.8em; color: #fca5a5;">
                <strong>üîÑ ATR Dinamis:</strong> <span id="current-atr">--</span> | 
                <strong>üí∞ Position Size:</strong> <span id="position-size">--</span>
            </div>
        </div>
        
        <!-- FINAL DECISION DENGAN STATISTIK -->
        <div class="final-decision">
            <h3 style="color: #60a5fa;">üéØ FINAL TRADING DECISION</h3>
            <div class="decision-action decision-hold" id="final-decision">ANALYZING...</div>
            <div style="color: #cbd5e1; margin: 15px 0; font-size: 0.9em;" id="decision-reason">
                Sistem menganalisa semua konfirmasi dengan risiko minimal...
            </div>
            
            <!-- AI ANALYSIS PANELS -->
            <div style="margin-top:15px;padding:12px;border-radius:8px;background:rgba(59,130,246,0.1);border:1px solid #3b82f6;">
                <div style="font-size:0.8em;color:#93c5fd;margin-bottom:6px;">
                    ü§ñ ChatGPT Analysis (Pattern Recognition)
                </div>
                <div id="chatgpt-decision" style="font-size:0.9em;color:#e2e8f0;">
                    Menunggu analisa AI...
                </div>
            </div>

            <div style="margin-top:12px;padding:12px;border-radius:8px;background:rgba(168,85,247,0.1);border:1px solid #a855f7;">
                <div style="font-size:0.8em;color:#d8b4fe;margin-bottom:6px;">
                    üß† Claude AI Analysis (Deep Reasoning)
                </div>
                <div id="claude-decision" style="font-size:0.9em;color:#e2e8f0;">
                    Menganalisis dengan Claude...
                </div>
            </div>

            <div style="margin-top:12px;padding:12px;border-radius:8px;background:rgba(236,72,153,0.1);border:1px solid #ec4899;">
                <div style="font-size:0.8em;color:#f9a8d4;margin-bottom:6px;">
                    üîÆ DeepSeek Analysis (Quantitative)
                </div>
                <div id="deepseek-decision" style="font-size:0.9em;color:#e2e8f0;">
                    Calculating probabilities...
                </div>
            </div>
            <div style="margin-top:12px;padding:12px;border-radius:8px;background:rgba(115,115,250,0.12);border:1px solid #6366f1;">
    <div style="font-size:0.8em;color:#c7d2fe;margin-bottom:6px;">
        üöÄ Grok Analysis (xAI ‚Äì No BS Probability)
    </div>
    <div id="grok-decision" style="font-size:0.9em;color:#e2e8f0;">
        Thinking without corporate training wheels...
    </div>
</div>
            
            <div class="stats-grid">
                <div>
                    <div style="font-size: 0.8em; color: #94a3b8;">Konfirmasi</div>
                    <div style="font-size: 1.2em; font-weight: bold;">
                        <span id="confirmations-count">0</span>/6
                    </div>
                </div>
                <div>
                    <div style="font-size: 0.8em; color: #94a3b8;">Confidence</div>
                    <div style="font-size: 1.2em; font-weight: bold;" id="confidence-level">--%</div>
                </div>
                <div>
                    <div style="font-size: 0.8em; color: #94a3b8;">Risiko</div>
                    <div style="font-size: 1.2em; font-weight: bold;" id="risk-score">LOW</div>
                </div>
                <div>
                    <div style="font-size: 0.8em; color: #94a3b8;">Accuracy</div>
                    <div style="font-size: 1.2em; font-weight: bold;" id="accuracy-score">--%</div>
                </div>
            </div>
            
            <!-- REKOMENDASI HARIAN/MINGGUAN -->
            <div style="margin-top: 20px; padding: 15px; background: rgba(30, 41, 59, 0.8); border-radius: 8px;">
                <h4 style="color: #10b981; margin-bottom: 10px;">üìÖ REKOMENDASI PERIODE TERBAIK</h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px;">
                    <div>
                        <div style="font-size: 0.8em; color: #94a3b8;">Harian Terbaik</div>
                        <div style="font-weight: bold;" id="best-daily">--:--</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8em; color: #94a3b8;">Mingguan</div>
                        <div style="font-weight: bold;" id="best-weekly">--</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8em; color: #94a3b8;">Bulanan</div>
                        <div style="font-weight: bold;" id="best-monthly">--</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- CHART -->
        <div class="chart-container">
            <canvas id="priceChart"></canvas>
        </div>
        
        <!-- KONTROL -->
        <div class="controls">
            <h3>‚öôÔ∏è PENGATURAN SISTEM</h3>
            
            <div class="input-group">
                <div class="input-field">
                    <label>Trading Pair</label>
                    <select id="symbol">
                        <option value="BTCUSDT">BTC/USDT</option>
                        <option value="ETHUSDT">ETH/USDT</option>
                        <option value="BNBUSDT">BNB/USDT</option>
                        <option value="SOLUSDT">SOL/USDT</option>
                    </select>
                </div>
                <div class="input-field">
                    <label>Timeframe Utama</label>
                    <select id="timeframe">
                        <option value="15m">15 Menit</option>
                        <option value="1h" selected>1 Jam</option>
                        <option value="4h">4 Jam</option>
                        <option value="1d">1 Hari</option>
                    </select>
                </div>
                <div class="input-field">
                    <label>Risk Profile</label>
                    <select id="risk-profile">
                        <option value="low">Low Risk</option>
                        <option value="medium" selected>Medium Risk</option>
                        <option value="high">High Risk</option>
                    </select>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; margin: 15px 0;">
                <label style="flex: 1; display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="auto-refresh" checked style="width: 18px; height: 18px;">
                    <span>Auto Refresh (30s)</span>
                </label>
                <label style="flex: 1; display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="risk-limit" checked style="width: 18px; height: 18px;">
                    <span>Limit Risk 2%</span>
                </label>
            </div>
            
            <button onclick="runAnalysis()" class="btn-success">üöÄ JALANKAN ANALISIS LENGKAP</button>
            <button onclick="resetSystem()">üîÑ RESET SYSTEM</button>
            
            <div id="loading" style="display: none; text-align: center; padding: 10px; color: #60a5fa;">
                ‚è≥ Menganalisa data pasar...
            </div>
            <div id="error-msg" style="display: none; text-align: center; padding: 10px; color: #ef4444; background: rgba(239, 68, 68, 0.1); border-radius: 6px; margin-top: 10px;"></div>
        </div>
    </div>
    
    <script>
        // VARIABEL GLOBAL
        let chart = null;
        let currentPrice = 0;
        let autoRefreshInterval = null;
        let confirmations = 0;
        let systemAccuracy = 0;
        
        // DATA HISTORIS UNTUK ANALISIS
        const historicalData = {
            bestTimes: {
                daily: ["09:00-11:00", "14:00-16:00", "20:00-22:00"],
                weekly: ["Senin", "Rabu", "Jumat"],
                monthly: ["Week 1-2", "Week 3-4"]
            },
            accuracyStats: {
                BTCUSDT: { winRate: 68.5, avgProfit: 2.3 },
                ETHUSDT: { winRate: 65.2, avgProfit: 2.1 },
                BNBUSDT: { winRate: 62.8, avgProfit: 1.9 },
                SOLUSDT: { winRate: 60.5, avgProfit: 2.4 }
            }
        };
        
        // FUNGSI UTAMA ANALISIS
        async function runAnalysis() {
            try {
                showLoading();
                const symbol = document.getElementById('symbol').value;
                const timeframe = document.getElementById('timeframe').value;
                
                // Simulasi data (dalam implementasi real, fetch dari API)
                await simulateMarketAnalysis(symbol, timeframe);
                
                // Analisis multi timeframe
                analyzeMultiTimeframe();
                
                // Evaluasi konfirmasi
                evaluateConfirmations();
                
                // Hitung risk management
                calculateRiskManagement();
                
                // Buat keputusan final
                makeFinalDecision();
                
                // Update chart
                updateChart();
                
                // Update rekomendasi periode
                updateTimeRecommendations();
                
                // Update akurasi sistem
                updateSystemAccuracy();
                
            } catch (error) {
                showError("Analisis gagal: " + error.message);
            } finally {
                hideLoading();
            }
        }
        
        // SIMULASI ANALISIS PASAR
        async function simulateMarketAnalysis(symbol, timeframe) {
            // Simulasi data acak (real implementation akan fetch dari Binance API)
            const conditions = ['Bullish', 'Bearish', 'Sideways', 'Volatile'];
            const volumes = ['High', 'Normal', 'Low'];
            
            // Update status utama
            document.getElementById('market-condition').textContent = 
                conditions[Math.floor(Math.random() * conditions.length)];
            document.getElementById('system-accuracy').textContent = 
                historicalData.accuracyStats[symbol]?.winRate.toFixed(1) + '%' || '65.0%';
            
            // Simulasi price
            currentPrice = 50000 + Math.random() * 5000;
            
            // Update multi timeframe
            const tfValues = ['Bullish', 'Bearish', 'Neutral'];
            document.getElementById('tf-daily').textContent = tfValues[0];
            document.getElementById('tf-daily-bias').textContent = 'Bullish';
            document.getElementById('tf-4h').textContent = tfValues[1];
            document.getElementById('tf-4h-bias').textContent = 'Bearish';
            document.getElementById('tf-1h').textContent = tfValues[2];
            document.getElementById('tf-1h-bias').textContent = 'Neutral';
            document.getElementById('tf-15m').textContent = tfValues[Math.floor(Math.random() * 2)];
            document.getElementById('tf-15m-bias').textContent = 'Momentum';
            
            // Analisis multi timeframe
            const analysis = "Trend harian bullish, 4H sedang koreksi, 1H netral, 15M menunjukkan momentum";
            document.getElementById('multi-tf-analysis').textContent = analysis;
            
            return true;
        }
        
        // ANALISIS MULTI TIMEFRAME
        function analyzeMultiTimeframe() {
            // Logic analisis alignment timeframe
            const daily = document.getElementById('tf-daily-bias').textContent;
            const fourHour = document.getElementById('tf-4h-bias').textContent;
            const oneHour = document.getElementById('tf-1h-bias').textContent;
            
            let alignment = 'Partial';
            if (daily === fourHour && fourHour === oneHour) alignment = 'Perfect';
            else if (daily === fourHour || fourHour === oneHour) alignment = 'Good';
            
            // Update confirmation matrix
            updateConfirmation('conf-trend', alignment === 'Perfect' || alignment === 'Good', 
                `Alignment: ${alignment}`);
        }
        
        // EVALUASI 6 KONFIRMASI
        function evaluateConfirmations() {
            confirmations = 0;
            
            // 1. Price Action
            const priceAction = Math.random() > 0.3;
            updateConfirmation('conf-price', priceAction, priceAction ? 'Strong' : 'Weak');
            if (priceAction) confirmations++;
            
            // 2. Trend Multi-TF
            const trend = document.getElementById('tf-daily-bias').textContent !== 'Neutral';
            updateConfirmation('conf-trend', trend, 'Aligned');
            if (trend) confirmations++;
            
            // 3. Volume Confirmation
            const volume = Math.random() > 0.4;
            updateConfirmation('conf-volume', volume, volume ? 'Confirming' : 'Divergence');
            if (volume) confirmations++;
            
            // 4. Momentum
            const momentum = Math.random() > 0.5;
            updateConfirmation('conf-momentum', momentum, momentum ? 'Strong' : 'Weak');
            if (momentum) confirmations++;
            
            // 5. Market Structure
            const structure = Math.random() > 0.6;
            updateConfirmation('conf-structure', structure, structure ? 'Clear' : 'Unclear');
            if (structure) confirmations++;
            
            // 6. Support/Resistance
            const supportResistance = Math.random() > 0.7;
            updateConfirmation('conf-support', supportResistance, 
                supportResistance ? 'At Level' : 'No Level');
            if (supportResistance) confirmations++;
            
            // Update count
            document.getElementById('confirmations-count').textContent = confirmations;
            
            // Calculate accuracy based on confirmations
            systemAccuracy = Math.min(95, 50 + (confirmations * 8));
            document.getElementById('accuracy-score').textContent = systemAccuracy.toFixed(1) + '%';
        }
        
        // UPDATE KONFIRMASI
        function updateConfirmation(elementId, isConfirmed, statusText) {
            const element = document.getElementById(elementId);
            const statusElement = element.querySelector('.confirmation-status');
            
            if (isConfirmed) {
                element.className = 'confirmation-item confirmed';
                statusElement.textContent = statusText;
                statusElement.style.background = 'rgba(16, 185, 129, 0.2)';
                statusElement.style.color = '#10b981';
            } else {
                element.className = 'confirmation-item rejected';
                statusElement.textContent = statusText;
                statusElement.style.background = 'rgba(239, 68, 68, 0.2)';
                statusElement.style.color = '#ef4444';
            }
        }
        
        // CALCULATE RISK MANAGEMENT
        function calculateRiskManagement() {
            const riskProfile = document.getElementById('risk-profile').value;
            const atr = currentPrice * 0.02; // Simulated ATR 2%
            
            // Calculate stop loss based on ATR
            const stopLossPercent = riskProfile === 'low' ? 1.5 : riskProfile === 'medium' ? 2.0 : 3.0;
            const stopLoss = (currentPrice * (1 - stopLossPercent/100)).toFixed(2);
            
            // Take profit with 1:2 risk/reward
            const riskAmount = currentPrice - stopLoss;
            const takeProfit = (currentPrice + (riskAmount * 2)).toFixed(2);
            
            // Update display
            document.getElementById('stop-loss').textContent = stopLoss;
            document.getElementById('take-profit').textContent = takeProfit;
            document.getElementById('current-atr').textContent = (atr/currentPrice*100).toFixed(2) + '%';
            
            // Calculate position size
            const accountBalance = 10000; // Example balance
            const riskAmountDollars = accountBalance * (stopLossPercent/100);
            const positionSize = (riskAmountDollars / (currentPrice - stopLoss)).toFixed(4);
            document.getElementById('position-size').textContent = positionSize;
            
            // Update risk level
            const riskLevel = stopLossPercent <= 1.5 ? 'LOW' : stopLossPercent <= 2.5 ? 'MEDIUM' : 'HIGH';
            document.getElementById('risk-level').textContent = riskLevel;
            document.getElementById('risk-score').textContent = riskLevel;
            document.getElementById('risk-level').className = riskLevel === 'LOW' ? 'positive' : 
                riskLevel === 'MEDIUM' ? 'neutral' : 'negative';
        }
        
        // MAKE FINAL DECISION
        function makeFinalDecision() {
            let decision = 'HOLD';
            let reason = '';
            let confidence = Math.min(95, confirmations * 15 + 20);
            
            // Decision logic
            if (confirmations >= 5) {
                decision = 'STRONG BUY';
                reason = `Semua konfirmasi aligned (${confirmations}/6). Confidence tinggi, risiko rendah.`;
            } else if (confirmations >= 4) {
                decision = 'BUY';
                reason = `Konfirmasi kuat (${confirmations}/6). Moderate confidence, manage risk.`;
            } else if (confirmations >= 3) {
                decision = 'WEAK BUY';
                reason = `Konfirmasi moderate (${confirmations}/6). High risk, kecilkan position size.`;
            } else if (confirmations <= 2) {
                decision = 'HOLD';
                reason = `Konfirmasi rendah (${confirmations}/6). Tunggu setup yang lebih baik.`;
            }
            
            // Adjust for risk level
            const riskLevel = document.getElementById('risk-level').textContent;
            if (riskLevel === 'HIGH' && decision.includes('BUY')) {
                decision = 'WEAK BUY';
                reason += ' PERINGATAN: Risk level tinggi!';
            }
            
            // Update display
            const decisionElement = document.getElementById('final-decision');
            decisionElement.textContent = decision;
            
            // Set class based on decision
            decisionElement.className = 'decision-action ';
            if (decision.includes('STRONG BUY')) {
                decisionElement.className += 'decision-buy';
            } else if (decision.includes('BUY')) {
                decisionElement.className += 'decision-buy';
            } else if (decision.includes('SELL')) {
                decisionElement.className += 'decision-sell';
            } else {
                decisionElement.className += 'decision-hold';
            }
            
            document.getElementById('decision-reason').textContent = reason;
            document.getElementById('confidence-level').textContent = confidence + '%';
            document.getElementById('system-score').textContent = confidence + '/100';
            
            // Generate AI decisions
            generateChatGPTDecision(decision, confirmations, confidence);
            generateClaudeDecision(decision, confirmations, confidence, riskLevel);
            generateDeepSeekDecision(decision, confirmations, confidence);
            generateGrokDecision(decision, confirmations, confidence);
        }
        
        function generateChatGPTDecision(decision, confirmations, confidence) {
            const tf = document.getElementById('multi-tf-analysis').textContent;
            const risk = document.getElementById('risk-level').textContent;

            let text = "";

            if (decision.includes("STRONG BUY")) {
                text = `AI: Semua TF searah. ${confirmations}/6 konfirmasi. Risk ${risk}. Ini high probability setup.`;
            } else if (decision.includes("BUY")) {
                text = `AI: Struktur market mendukung long. ${confirmations}/6 konfirmasi, tunggu momentum kecil sebelum entry.`;
            } else if (decision.includes("WEAK BUY")) {
                text = `AI: Setup belum bersih. Bisa entry kecil atau tunggu candle konfirmasi.`;
            } else {
                text = `AI: Jangan entry. Konfirmasi lemah (${confirmations}/6). Potensi trap/sideways.`;
            }

            document.getElementById('chatgpt-decision').textContent =
                text + ` | TF: ${tf} | Confidence: ${confidence}%`;
        }

        function generateClaudeDecision(decision, confirmations, confidence, riskLevel) {
            const marketCondition = document.getElementById('market-condition').textContent;
            const tfDaily = document.getElementById('tf-daily-bias').textContent;
            const tf4h = document.getElementById('tf-4h-bias').textContent;
            const tf1h = document.getElementById('tf-1h-bias').textContent;
            
            let analysis = "";
            let reasoning = "";
            let recommendation = "";

            // Deep reasoning berdasarkan kondisi market
            if (decision.includes("STRONG BUY")) {
                reasoning = `Analisis menunjukkan konvergensi kuat: ${confirmations}/6 faktor terkonfirmasi dengan alignment timeframe yang solid (Daily: ${tfDaily}, 4H: ${tf4h}, 1H: ${tf1h}).`;
                
                if (riskLevel === "LOW") {
                    recommendation = "Probabilitas tinggi untuk entry dengan position size normal. Market structure mendukung continuation.";
                } else {
                    recommendation = "Meskipun setup kuat, pertimbangkan reduce position size karena risk level yang elevated. Wait untuk pullback ideal.";
                }
            } else if (decision.includes("BUY")) {
                reasoning = `Setup menunjukkan potensi positif dengan ${confirmations}/6 konfirmasi. Namun perhatikan divergensi antar timeframe yang dapat mengindikasikan koreksi jangka pendek.`;
                
                recommendation = `Entry bertahap lebih disarankan. Watch untuk price action confirmation di support key level sebelum add position.`;
            } else if (decision.includes("WEAK BUY")) {
                reasoning = `Konfirmasi parsial (${confirmations}/6) dengan mixed signals dari multi-timeframe analysis. Market condition ${marketCondition} menambah kompleksitas.`;
                
                recommendation = `High risk setup. Jika tetap entry, gunakan ultra-tight stop loss dan position size minimal (max 0.5% risk). Consider skip setup ini.`;
            } else {
                reasoning = `Insufficient confirmation (${confirmations}/6). Timeframe tidak aligned dan market structure unclear. Kondisi ${marketCondition} tidak mendukung probabilitas tinggi.`;
                
                recommendation = `STAY OUT. Tunggu setup dengan minimal 4/6 konfirmasi dan timeframe alignment yang lebih baik. Patience adalah edge Anda.`;
            }

            // Format final output
            analysis = `${reasoning} ${recommendation}`;
            
            // Add risk-adjusted insight
            if (riskLevel === "HIGH") {
                analysis += ` ‚ö†Ô∏è CRITICAL: Risk level saat ini HIGH - pertimbangkan skip trade atau wait untuk kondisi yang lebih favorable.`;
            }

            document.getElementById('claude-decision').textContent = analysis;
        }

        function generateDeepSeekDecision(decision, confirmations, confidence) {
            const winRate = document.getElementById('win-rate').textContent;
            const accuracy = document.getElementById('accuracy-score').textContent;
            
            // Quantitative probability calculation
            const baseProb = confirmations * 12.5; // Each confirmation adds ~12.5% probability
            const adjustedProb = Math.min(95, baseProb + (confidence * 0.3));
            
            let expectedValue = "";
            let probability = "";
            let quantAnalysis = "";

            if (decision.includes("STRONG BUY")) {
                const rr = 2.0; // Risk:Reward ratio
                const ev = (adjustedProb/100 * rr) - ((100-adjustedProb)/100 * 1);
                expectedValue = `+${(ev * 100).toFixed(1)}%`;
                probability = `Win Prob: ${adjustedProb.toFixed(1)}%`;
                quantAnalysis = `EV positif kuat. R:R 1:2. Dengan ${confirmations}/6 signals, statistical edge sangat favorable.`;
            } else if (decision.includes("BUY")) {
                const rr = 1.8;
                const ev = (adjustedProb/100 * rr) - ((100-adjustedProb)/100 * 1);
                expectedValue = ev > 0 ? `+${(ev * 100).toFixed(1)}%` : `${(ev * 100).toFixed(1)}%`;
                probability = `Win Prob: ${adjustedProb.toFixed(1)}%`;
                quantAnalysis = `EV ${ev > 0 ? 'positif' : 'marginal'}. Setup acceptable tapi bukan optimal. Consider position sizing reduction 30-50%.`;
            } else if (decision.includes("WEAK BUY")) {
                const rr = 1.5;
                const ev = (adjustedProb/100 * rr) - ((100-adjustedProb)/100 * 1);
                expectedValue = ev > 0 ? `+${(ev * 100).toFixed(1)}%` : `${(ev * 100).toFixed(1)}%`;
                probability = `Win Prob: ${adjustedProb.toFixed(1)}%`;
                quantAnalysis = `EV rendah atau negatif. Risk terlalu tinggi vs potential reward. Probabilitas success < 60%. Avoid atau minimal size only.`;
            } else {
                expectedValue = "Negative";
                probability = `Win Prob: ${adjustedProb.toFixed(1)}%`;
                quantAnalysis = `Matematically unfavorable. ${confirmations}/6 signals insufficient untuk positive edge. Expected value negatif. NO TRADE.`;
            }

            document.getElementById('deepseek-decision').textContent = 
                `${quantAnalysis} | ${probability} | EV: ${expectedValue} | System Acc: ${accuracy}`;
        }
        
        // UPDATE TIME RECOMMENDATIONS
        function updateTimeRecommendations() {
            const times = historicalData.bestTimes;
            document.getElementById('best-daily').textContent = times.daily[Math.floor(Math.random() * times.daily.length)];
            document.getElementById('best-weekly').textContent = times.weekly[Math.floor(Math.random() * times.weekly.length)];
            document.getElementById('best-monthly').textContent = times.monthly[Math.floor(Math.random() * times.monthly.length)];
        }
        
        // UPDATE SYSTEM ACCURACY
        function updateSystemAccuracy() {
            const symbol = document.getElementById('symbol').value;
            const stats = historicalData.accuracyStats[symbol];
            
            if (stats) {
                document.getElementById('win-rate').textContent = stats.winRate.toFixed(1) + '%';
                
                // Adjust based on current confirmations
                const adjustedWinRate = Math.min(95, stats.winRate + (confirmations * 2));
                document.getElementById('accuracy-score').textContent = adjustedWinRate.toFixed(1) + '%';
            }
        }
        function generateGrokDecision(decision, confirmations, confidence) {
    const market = document.getElementById('market-condition').textContent;
    const tfSummary = document.getElementById('multi-tf-analysis').textContent;
    const risk = document.getElementById('risk-level').textContent;
    const confCount = confirmations;
    
    let grokText = "";
    let edgeComment = "";
    let brutalHonesty = "";

    const realProb = Math.min(92, confCount * 13 + Math.floor(confidence * 0.35) - 8); // Grok agak skeptis

    if (decision.includes("STRONG BUY")) {
        edgeComment = `Edge nyata ada (${realProb}%), tapi ingat: market suka bikin orang yang terlalu percaya diri jadi makan nasi tanpa lauk.`;
        brutalHonesty = confCount === 6 
            ? "6/6? Langka banget. Kalau ini gagal ‚Üí mungkin black swan atau kamu salah baca struktur."
            : "STRONG BUY tapi cuma 5/6? Masih masuk akal, tapi jangan all-in seperti degen.";
    } 
    else if (decision.includes("BUY")) {
        edgeComment = `Setup lumayan (${realProb}%). Tapi kalau kamu entry cuma karena FOMO, ya sudah siap-siap jadi liquidity provider.`;
        brutalHonesty = "4‚Äì5 konfirmasi = zona abu-abu terbaik buat trader kompeten. Kalau <4 ‚Üí gambling.";
    } 
    else if (decision.includes("WEAK BUY")) {
        edgeComment = `Ini bukan edge, ini spekulasi berbalut analisis (${realProb}%).`;
        brutalHonesty = "Kalau risk appetite kamu tinggi dan akun kecil ‚Üí boleh coba receh. Kalau akun serius ‚Üí skip, tunggu yang lebih bersih.";
    } 
    else { // HOLD / NO TRADE
        edgeComment = `No edge jelas (${realProb}%). Market lagi main tebak-tebakan sama trader retail.`;
        brutalHonesty = "Satu-satunya keputusan cerdas hari ini adalah tidak mengambil keputusan. Cash adalah position yang valid.";
    }

    if (risk === "HIGH") {
        brutalHonesty += " ‚ö†Ô∏è RISK HIGH = jangan sok kuat. Market tidak peduli seberapa pintar analisa kamu.";
    }

    grokText = `${edgeComment} ${brutalHonesty} | Real prob ~${realProb}% | ${tfSummary.split('.')[0] || 'TF mixed'} | Market: ${market}`;

    document.getElementById('grok-decision').textContent = grokText;
}
        // UPDATE CHART
        function updateChart() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }
            
            // Generate sample data
            const labels = [];
            const data = [];
            let value = currentPrice;
            
            for (let i = 20; i >= 0; i--) {
                labels.push(`${i * 5}m ago`);
                value += (Math.random() - 0.5) * currentPrice * 0.01;
                data.push(value);
            }
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels.reverse(),
                    datasets: [{
                        label: 'Price',
                        data: data,
                        borderColor: confirmations >= 4 ? '#10b981' : 
                                   confirmations >= 3 ? '#f59e0b' : '#ef4444',
                        backgroundColor: confirmations >= 4 ? 'rgba(16, 185, 129, 0.1)' : 
                                       confirmations >= 3 ? 'rgba(245, 158, 11, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false }
                    },
                    scales: {
                        x: {
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#94a3b8', maxRotation: 0 }
                        },
                        y: {
                            grid: { color: 'rgba(255,255,255,0.1)' },
                            ticks: { color: '#94a3b8' }
                        }
                    }
                }
            });
        }
        
        // RESET SYSTEM
        function resetSystem() {
            confirmations = 0;
            document.querySelectorAll('.confirmation-item').forEach(el => {
                el.className = 'confirmation-item waiting';
                const status = el.querySelector('.confirmation-status');
                status.textContent = 'Menunggu';
                status.style.background = 'rgba(245, 158, 11, 0.2)';
                status.style.color = '#f59e0b';
            });
            
            document.getElementById('final-decision').textContent = 'ANALYZING...';
            document.getElementById('final-decision').className = 'decision-action decision-hold';
            document.getElementById('decision-reason').textContent = 'Sistem direset...';
            document.getElementById('confirmations-count').textContent = '0';
            document.getElementById('confidence-level').textContent = '--%';
            document.getElementById('system-score').textContent = '--/100';
            
            // Reset AI decisions
            document.getElementById('chatgpt-decision').textContent = 'Menunggu analisa AI...';
            document.getElementById('claude-decision').textContent = 'Menganalisis dengan Claude...';
            document.getElementById('deepseek-decision').textContent = 'Calculating probabilities...';
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
            }
        }
        
        // SETUP AUTO REFRESH
        function setupAutoRefresh() {
            const checkbox = document.getElementById('auto-refresh');
            
            checkbox.addEventListener('change', function() {
                if (this.checked) {
                    autoRefreshInterval = setInterval(runAnalysis, 30000); // 30 seconds
                } else if (autoRefreshInterval) {
                    clearInterval(autoRefreshInterval);
                    autoRefreshInterval = null;
                }
            });
            
            // Start auto refresh if checked
            if (checkbox.checked) {
                autoRefreshInterval = setInterval(runAnalysis, 30000);
            }
        }
        
        // HELPER FUNCTIONS
        function showLoading() {
            document.getElementById('loading').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loading').style.display = 'none';
        }
        
        function showError(message) {
            const errorDiv = document.getElementById('error-msg');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        // INITIALIZE
        document.addEventListener('DOMContentLoaded', function() {
            setupAutoRefresh();
            runAnalysis(); // Run initial analysis
            
            // Add change listeners
            document.getElementById('symbol').addEventListener('change', runAnalysis);
            document.getElementById('timeframe').addEventListener('change', runAnalysis);
            document.getElementById('risk-profile').addEventListener('change', runAnalysis);
        });
    </script>
</body>
</html>
